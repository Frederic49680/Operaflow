---
alwaysApply: true
---
ğŸ§­ PRD â€” RH Formations v1.1
(Organismes de formation, CoÃ»ts, Plan prÃ©visionnel & Budget)

Auteur : Fred Baudry
Stack : Next.js 15 / Supabase / Tailwind / Recharts / SMTP

1) Objectifs

RÃ©fÃ©rencer les organismes (coordonnÃ©es, agrÃ©ments, domaines).

Cataloguer les formations (durÃ©e, validitÃ©, prÃ©requis) avec modÃ¨les de coÃ»t (par tÃªte, par session, e-learning, dÃ©placements).

Plan prÃ©visionnel : poser des semaines de formation par ressource (et/ou sessions), avec coÃ»t prÃ©visionnel auto.

Budget annuel : consolider prÃ©vu vs rÃ©alisÃ© (par site, organisme, formation, ressource), sorties CSV/PDF.

2) Utilisateurs
RÃ´le	AccÃ¨s	Actions
RH	CRUD complet	GÃ¨re organismes, catalogue, planifie, budgÃ¨te
Responsable Site	Lecture + proposition	Propose besoins, voit budget site
Direction / QSE	Lecture globale	Suit le budget, conformitÃ©
Planificateur	Lecture	Voit indispos â€œen formationâ€
3) FonctionnalitÃ©s
3.1 Organismes de formation (rÃ©fÃ©rentiel)

Fiche organisme : nom, SIRET, contact, email, tÃ©lÃ©phone, adresse, domaines, nÂ° dâ€™agrÃ©ment, notes.

Statut : actif/inactif, prÃ©fÃ©rences (site, rÃ©gion).

PiÃ¨ces jointes : contrat-cadre, CGV, attestations.

3.2 Catalogue des formations

Fiche formation :

LibellÃ©, code interne, type (habilitante / technique / QSE / CACES / SSTâ€¦)

DurÃ©e (jours / heures), validitÃ© (mois) si habilitante

ModalitÃ© : prÃ©sentiel / distanciel / e-learning / mixte

PrÃ©requis, compÃ©tences associÃ©es

Organisme proposÃ© (par dÃ©faut) + liste dâ€™alternatifs

ModÃ¨le de coÃ»t (multi-modalitÃ©s) :

cout_unitaire_par_participant (HT)

cout_session (forfait salle/formateur)

cout_elearning (par licence)

frais_deplacement (barÃ¨me ou montant)

tva %

Site / RÃ©gion / Organisme overrides possibles (ex : IDF plus cher)

3.3 Plan prÃ©visionnel (semaine ressource)

Poser une semaine de formation Ã  une ressource :

Ressource, semaine ISO (AAAA-WW), formation choisie, organisme (dÃ©faut = proposÃ©)

Nombre de jours/h cumulÃ©s, modalitÃ©

Statut : prÃ©visionnel â†’ validÃ© â†’ rÃ©alisÃ© â†’ annulÃ©

Effets :

IndisponibilitÃ© planning (Gantt) cette semaine (bloc â€œen formationâ€)

CoÃ»t prÃ©visionnel automatique :

coÃ»t = (cout_unitaire_par_participant OU cout_elearning)
       + quote-part du cout_session (si session partagÃ©e)
       + frais_deplacement (si prÃ©sentiel)


Si plusieurs ressources sur la mÃªme session (mÃªme semaine + mÃªme formation + mÃªme organisme) :

le cout_session est rÃ©parti au prorata des participants (ou Ã©gal).

3.4 Sessions (option intermÃ©diaire)

CrÃ©er une session : date(s), organisme, lieu, capacitÃ©, liste participants.

Lier des semaines ressource Ã  une session (mutualisation des coÃ»ts).

Attacher documents (convocations, feuilles prÃ©sence).

3.5 Budget annuel & suivi

Budget prÃ©visionnel : somme des plans validÃ©s sur lâ€™annÃ©e.

RÃ©alisÃ© : Ã  lâ€™issue dâ€™une session (ou semaine â€œrÃ©alisÃ©eâ€), saisir/rÃ©cupÃ©rer le coÃ»t rÃ©el (facture) et la prÃ©sence.

Ã‰carts : rÃ©alisÃ© - prÃ©visionnel.

KPI :

Budget prÃ©vu / engagÃ© / rÃ©alisÃ© (global, par site, par organisme, par formation)

Nb. jours-homme en formation (impact dispo prod)

Taux de rÃ©alisation du plan (% tenu)

Exports : CSV / PDF dÃ©taillÃ© (axes : annÃ©e, site, organisme, formation, ressource).

3.6 Rappels & conformitÃ©

Alerte 60/30/0 jours avant expiration dâ€™une habilitation (reste inchangÃ© vs module Formations).

Alerte â€œSemaine de formation Ã  venirâ€ aux participants et au manager (J-7).

Alerte dÃ©rive budget (> X %) par site/organisme.

4) ModÃ¨le de donnÃ©es (Supabase)
organismes_formation
Champ	Type
id (uuid) pk	
nom text	
siret text	
contact text	
email text	
telephone text	
adresse text	
domaines text[]	
agrement text	
actif bool default true	
notes text	
created_at timestamptz	
formations_catalogue
Champ	Type
id (uuid) pk	
code text unique	
libelle text	
type_formation text	
duree_heures numeric	
validite_mois int nullable	
modalite text (presentiel/distanciel/elearning/mixte)	
prerequis text	
competences text[]	
organisme_defaut_id uuid fk â†’ organismes_formation	
created_at timestamptz	
formations_tarifs

(permet plusieurs grilles par formation, organisme, rÃ©gion, modalitÃ©)

Champ	Type
id (uuid) pk	
formation_id uuid fk	
organisme_id uuid fk	
modalite text	
site_id uuid nullable (override local)	
cout_unitaire numeric nullable	
cout_session numeric nullable	
cout_elearning numeric nullable	
frais_deplacement numeric nullable	
tva numeric default 20	
date_debut date	
date_fin date nullable	
actif bool default true	
plan_formation_ressource

(la â€œsemaine prÃ©visionnelleâ€)

Champ	Type
id (uuid) pk	
collaborateur_id uuid fk â†’ ressources	
formation_id uuid fk	
organisme_id uuid fk	
semaine_iso text (AAAA-WW)	
date_debut date nullable	
date_fin date nullable	
modalite text	
statut text âˆˆ {previsionnel, valide, realise, annule}	
cout_prevu_ht numeric	
cout_realise_ht numeric nullable	
session_id uuid nullable fk â†’ formations_sessions	
commentaire text	
created_at timestamptz	
formations_sessions (optionnel mais conseillÃ©)
Champ	Type
id (uuid) pk	
formation_id uuid fk	
organisme_id uuid fk	
site_id uuid nullable	
date_debut date	
date_fin date	
capacite int	
cout_session_ht numeric	
statut text âˆˆ {ouverte, fermee, realisee, annulee}	
documents jsonb nullable	
Vues utiles

V_Budget_Formations_Annuel (prÃ©vu, engagÃ©, rÃ©alisÃ©, Ã©cart par axe)

V_Formation_Indispo_Planning (pour Gantt indisponibilitÃ©s)

V_Habilitations_A_Renouveler (intÃ©grÃ© aux alertes)

5) Calculs & rÃ¨gles
5.1 CoÃ»t prÃ©visionnel (semaine ressource)
cout_prevu_ht =
  (cout_unitaire_par_participant OU cout_elearning)
+ (cout_session_ht_reparti_si_session)
+ (frais_deplacement le cas Ã©chÃ©ant)


Choix tarif : sÃ©lectionner le tarif le plus spÃ©cifique (formation+organisme+site+modalitÃ© avec dates valides).

RÃ©partition cout_session : cout_session / nb_participants_session.

5.2 Passage en â€œrÃ©alisÃ©â€

Ã€ la clÃ´ture de session ou validation de la semaine :

renseigner prÃ©sence (oui/non), cout_realise_ht (si facture connue),

si formation habilitante : crÃ©er/mettre Ã  jour une entrÃ©e dans formations (dossier collaborateur) avec date_obtention = date_fin, validite_mois â†’ date_expiration.

stocker justificatifs (feuilles Ã©margement / attestation).

5.3 IndisponibilitÃ©s Planning

Lorsquâ€™une semaine prÃ©visionnelle est valide :

crÃ©er un bloc indisponibilitÃ© dans Planning (type = formation), visible par le planificateur.

6) Automatisations
TÃ¢che	FrÃ©quence	Action
fn_pick_tarif_applicable()	on insert/update plan	Choisit le bon tarif et calcule cout_prevu_ht
cron_rappel_semaine_formation()	J-7 08:00	Mail participant + manager
cron_alert_budget_derives()	mensuel	Alerte si > X % dâ€™Ã©cart prÃ©vu vs rÃ©alisÃ©
fn_close_session()	Ã  la clÃ´ture	Calcule coÃ»ts rÃ©els, met â€œrÃ©alisÃ©â€, pousse habilitation si besoin
fn_sync_indispo_planning()	on status change	CrÃ©e/supprime bloc indispo â€œformationâ€
7) UI / UX

Organismes : table + fiche + docs.

Catalogue : table filtrable (type, modalitÃ©, organisme), bouton â€œAjouter tarifâ€.

Plan prÃ©visionnel :

Vue semaine (ressource) + vue session (regroupÃ©e)

Bouton â€œPoser une semaineâ€ â†’ select formation â†’ select organisme â†’ semaine ISO â†’ calc auto du coÃ»t â†’ statut prÃ©visionnel

Switch â€œValiderâ€ (verrouille, crÃ©e indispo planning)

Budget :

Cartes KPI : PrÃ©vu, EngagÃ©, RÃ©alisÃ©, Ã‰cart (annÃ©e / site / organisme)

Graphiques : barres empilÃ©es par mois ; donut par type de formation

Exports : CSV / PDF

8) CritÃ¨res dâ€™acceptation

 RÃ©fÃ©rentiel Organismes complet (recherche + actif/inactif).

 Catalogue gÃ¨re validitÃ© + modÃ¨le de coÃ»t multi-modalitÃ©s.

 Semaine prÃ©visionnelle calcule coÃ»t prÃ©visionnel juste (tarif applicable).

 Session mutualise cout_session entre participants.

 IndisponibilitÃ© planning gÃ©nÃ©rÃ©e si statut = validÃ©.

 Budget annuel (prÃ©vu/engagÃ©/rÃ©alisÃ©/Ã©cart) agrÃ©gÃ© par site/organisme/formation.

 Passage en rÃ©alisÃ© crÃ©e/actualise habilitations si concernÃ© (date dâ€™expiration calculÃ©e).

 Exports CSV/PDF conformes.

 Alerte J-7 envoyÃ©e aux participants.

9) Ã‰volutions possibles

Portail collaborateur (demande de formation, validation manager).

Comparateur de devis multi-organismes pour une mÃªme formation.

IntÃ©gration factures fournisseurs pour rapprocher coÃ»ts rÃ©els automatiquement.

Score qualitÃ© par organisme (NPS interne, dÃ©lais, conformitÃ© doc).
---
alwaysApply: true
---
üß≠ PRD ‚Äî Module Absences & Disponibilit√©s
Auteur : Fred Baudry
Version : 1.0
Stack : Next.js 15 / Supabase / Tailwind / Recharts
Objectif principal :
G√©rer les absences et les disponibilit√©s du personnel afin d‚Äôalimenter la planification Gantt, les calculs de couverture, et le suivi RH.
________________________________________
1Ô∏è‚É£ Objectif
Cr√©er une interface RH et planificateur d√©di√©e √† la gestion des absences, permettant de :
‚Ä¢	Ajouter, modifier et suivre les absences par collaborateur ;
‚Ä¢	Visualiser les absences √† venir, en cours et pass√©es ;
‚Ä¢	Calculer automatiquement la disponibilit√© r√©elle des ressources ;
‚Ä¢	Exclure les absents des plannings futurs ;
‚Ä¢	Synchroniser les donn√©es avec le module RH et la Gantt.
________________________________________
2Ô∏è‚É£ Utilisateurs cibles
R√¥le	Acc√®s	Actions
RH / Administratif	Acc√®s total	CRUD complet sur toutes les absences
Planificateur / Conducteur	Lecture + ajout	Peut d√©clarer une absence ponctuelle sur une ressource
Responsable de site	Lecture restreinte	Voit les absences de son site uniquement
Direction	Lecture seule	Vue consolid√©e multi-sites
________________________________________
3Ô∏è‚É£ Fonctionnalit√©s principales
üîπ 3.1 Tableau principal des absences
‚Ä¢	Vue filtrable et triable :
o	Colonnes : Collaborateur, Site, Type d‚Äôabsence, Date d√©but, Date fin, Motif, Statut (√† venir / en cours / pass√©e).
‚Ä¢	Filtres : site / type / statut / p√©riode / comp√©tence.
‚Ä¢	Recherche libre sur nom, site ou motif.
‚Ä¢	Affichage visuel (ic√¥ne ou couleur par type d‚Äôabsence).
‚Ä¢	Boutons :
o	‚Äú+ Nouvelle absence‚Äù ‚Üí ajout d‚Äôune absence.
o	‚ÄúExporter CSV / Excel‚Äù.
________________________________________
üîπ 3.2 Cr√©ation / modification d‚Äôabsence
‚Ä¢	Formulaire ‚ÄúNouvelle absence‚Äù (modale ou page lat√©rale) :
o	Champs obligatoires :
ÔÇß	Collaborateur (dropdown dynamique filtr√© sur ressources actives)
ÔÇß	Type d‚Äôabsence (liste : CP, Maladie, Formation, Mission, Autre)
ÔÇß	Date d√©but / fin
o	Champs facultatifs :
ÔÇß	Motif / commentaire
o	Validations :
ÔÇß	Pas de chevauchement avec une absence existante.
ÔÇß	Collaborateur actif obligatoire.
ÔÇß	Date fin ‚â• date d√©but.
‚Ä¢	L‚Äôabsence devient ‚Äúen cours‚Äù automatiquement √† la date de d√©but.
________________________________________
üîπ 3.3 Statut et logique m√©tier
Statut	D√©finition	Comportement
√Ä venir	Absence planifi√©e, date future	Visible dans planning mais non active
En cours	Absence en cours	Collaborateur indisponible (exclu planif)
Pass√©e	Date de fin d√©pass√©e	Absence termin√©e (historis√©e)
‚Ä¢	Calcul automatique du statut via la date syst√®me (cron journalier).
‚Ä¢	Si collaborateur devient inactif ‚Üí suppression auto des absences futures.
________________________________________
üîπ 3.4 Disponibilit√© & int√©gration
‚Ä¢	Disponibilit√© = (Ressources actives) ‚Äì (Ressources absentes √† la p√©riode).
‚Ä¢	Chaque absence r√©duit la capacit√© de la ressource √† 0 pour les dates concern√©es.
‚Ä¢	Les vues Gantt et Ad√©quation charge/comp√©tence utilisent cette disponibilit√© ajust√©e.
‚Ä¢	L‚Äôabsence d‚Äôun responsable impacte la disponibilit√© de son affaire dans le suivi projets.
________________________________________
üîπ 3.5 Visualisation graphique
‚Ä¢	Graphique en barres empil√©es 100 % : disponible / absent par site ou comp√©tence.
‚Ä¢	Diagramme hebdomadaire : absents par jour (segmentation par type).
‚Ä¢	Jauge de disponibilit√© globale (% de ressources disponibles / totales).
‚Ä¢	Tooltip : liste des collaborateurs absents, type et dur√©e.
________________________________________
üîπ 3.6 Alertes & notifications
‚Ä¢	Envoi automatique d‚Äôun mail √† :
o	Le responsable de site si > X % de son √©quipe absente la semaine suivante.
o	Le RH si absence de plus de 15 jours (contr√¥le m√©dical / administratif).
‚Ä¢	Notifications internes via Supabase Function + SMTP.
‚Ä¢	Journal des alertes dans table alerts.
________________________________________
4Ô∏è‚É£ Mod√®le de donn√©es (Supabase)
Table : absences
Champ	Type	Description
id	uuid	Identifiant unique
ressource_id	uuid	Lien ‚Üí ressources.id
type	text	CP / Maladie / Formation / Mission / Autre
site	text	Site du collaborateur
date_debut	date	D√©but absence
date_fin	date	Fin absence
motif	text	Description ou raison
statut	text	√† venir / en cours / pass√©e
created_by	uuid	Utilisateur ayant ajout√©
created_at	timestamp	Date de cr√©ation
Table : alerts
Champ	Type	Description
id	uuid	Identifiant
cible	text	RH / Responsable
type	text	‚ÄúTaux absence √©lev√©‚Äù, ‚ÄúAbsence longue‚Äù
message	text	Contenu notification
date_envoi	timestamp	Date d‚Äôenvoi
statut	text	‚Äúenvoy√©‚Äù, ‚Äúlu‚Äù
________________________________________
5Ô∏è‚É£ R√®gles m√©tiers
‚Ä¢	Un collaborateur inactif ne peut pas recevoir d‚Äôabsence future.
‚Ä¢	Une absence ne peut pas chevaucher une autre sur le m√™me collaborateur.
‚Ä¢	Une absence en cours rend la ressource indisponible pour toute affectation.
‚Ä¢	Statut recalcul√© automatiquement chaque nuit (cron Supabase).
‚Ä¢	Les absences impactent la disponibilit√© dans tous les calculs de charge.
‚Ä¢	Si absence > 15 jours ‚Üí mail automatique au RH.
‚Ä¢	Les absences pass√©es sont archiv√©es mais conserv√©es pour reporting.
________________________________________
6Ô∏è‚É£ Crit√®res d‚Äôacceptation
ID	Crit√®re	Validation
ABS-01	Ajout d‚Äôune absence valide sur ressource active	‚úÖ
ABS-02	D√©tection chevauchement bloquante	‚úÖ
ABS-03	Changement automatique du statut √† la date du jour	‚úÖ
ABS-04	Synchronisation disponibilit√© dans planification	‚úÖ
ABS-05	Export CSV/Excel complet des absences	‚úÖ
ABS-06	Graphiques absents/disponibles par site fonctionnels	‚úÖ
ABS-07	Alertes email automatiques (taux > seuil / absence longue)	‚úÖ
ABS-08	Interface fluide, responsive et filtrable	‚úÖ
ABS-09	Historique conserv√© et consultable par RH	‚úÖ
________________________________________
7Ô∏è‚É£ Stack technique
√âl√©ment	Lib / Service	D√©tails
Backend	Supabase	Tables absences, alerts
Frontend	Next.js + Tailwind	Tableaux et graphiques
Validation	React Hook Form + Zod	Champs et r√®gles m√©tier
Charts	Recharts	Barres empil√©es, jauge dispo
Alertes	Supabase Functions + SMTP	Cron journali√®res
Auth	Supabase Session	Filtrage par r√¥le
Export	SheetJS	CSV / Excel
Date	Day.js	Calculs de statut automatique
________________________________________
8Ô∏è‚É£ UI / Composants
Composant	R√¥le
AbsencesTable	Tableau principal (filtrable)
AbsenceFormModal	Formulaire ajout / modification
FilterBar	Filtres (site, type, p√©riode, statut)
AvailabilityChart	Jauge / barres 100 % dispo/absent
AlertsPanel	Liste des notifications
ExportButton	Export CSV / XLSX
________________________________________
9Ô∏è‚É£ Coordination inter-modules
Module li√©	Interaction
RH Collaborateurs	L‚Äôabsence est li√©e √† ressources.id, et impossible pour un inactif.
Planification Gantt	Les ressources absentes sont exclues du pool de planif pendant la p√©riode.
Ad√©quation charge/comp√©tence	Les absents r√©duisent la capacit√© r√©elle.
Suivi Projets	Les absences du responsable impactent le statut des activit√©s.


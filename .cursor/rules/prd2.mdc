---
alwaysApply: true
---

PRD ‚Äî Module Sites
Auteur : Fred Baudry
Version : 1.1 (version √©pur√©e et int√©gr√©e)
Stack : Next.js 15 / Supabase / Tailwind / Recharts
Objectif principal :
G√©rer la base des sites (unit√©s op√©rationnelles) servant de cl√© hi√©rarchique dans tous les modules ‚Äî RH, planification, suivi projets et ad√©quation.
________________________________________
1Ô∏è‚É£ Objectif
Cr√©er un module simple et robuste pour :
‚Ä¢	Cr√©er / modifier / archiver les sites ;
‚Ä¢	Assigner un responsable principal et un rempla√ßant ;
‚Ä¢	Suivre l‚Äô√©tat op√©rationnel du site (actif / en pause / ferm√©) ;
‚Ä¢	Servir de r√©f√©rence centrale pour les collaborateurs, affaires et activit√©s.
________________________________________
2Ô∏è‚É£ Utilisateurs cibles
R√¥le	Acc√®s	Actions
Administratif / RH	Acc√®s total	CRUD complet sur les sites
Planificateur	Lecture + √©dition limit√©e	Modifie le responsable ou statut
Responsable de site	Lecture seule	Voit uniquement son site et ses donn√©es
Direction	Lecture globale	Vue multi-sites (lecture seule)
________________________________________
3Ô∏è‚É£ Fonctionnalit√©s principales
üîπ 3.1 Tableau des sites
‚Ä¢	Vue synth√©tique :
o	Nom du site
o	Code site (cl√© unique ex. ‚ÄúE-03A‚Äù)
o	Responsable principal
o	Rempla√ßant (optionnel)
o	Nombre de collaborateurs actifs (auto-calcul)
o	Nombre d‚Äôaffaires en cours (auto-calcul)
o	Statut (Actif / En pause / Ferm√©)
‚Ä¢	Filtres rapides : par statut, responsable ou code site.
‚Ä¢	Recherche libre sur nom ou code.
‚Ä¢	Boutons :
o	‚Äú+ Nouveau site‚Äù (cr√©ation)
o	‚ÄúExporter CSV / Excel‚Äù.
________________________________________
üîπ 3.2 Cr√©ation / modification d‚Äôun site
Formulaire all√©g√© :
‚Ä¢	Champs obligatoires :
o	Nom du site
o	Code site (unique)
o	Responsable principal (collaborateur actif)
o	Statut (Actif / En pause / Ferm√©)
‚Ä¢	Champs facultatifs :
o	Rempla√ßant (autre collaborateur actif)
o	Commentaire libre
‚Ä¢	Validation :
o	Code site unique.
o	Responsable actif obligatoire.
________________________________________
üîπ 3.3 Gestion du statut
Statut	Description	Effet
Actif	Site op√©rationnel	Visible partout
En pause	Activit√© temporairement suspendue	Avertissement dans la Gantt
Ferm√©	Site termin√©	Archiv√©, plus d‚Äôaffectation possible
Lors du passage √† ‚ÄúFerm√©‚Äù :
‚Ä¢	Aucune nouvelle affectation possible.
‚Ä¢	Les activit√©s et affaires en cours sont cl√¥tur√©es automatiquement (statut = termin√©).
________________________________________
üîπ 3.4 Statistiques de base
Chaque site agr√®ge automatiquement :
‚Ä¢	Effectif actif (ressources li√©es)
‚Ä¢	Nombre d‚Äôaffaires ouvertes
‚Ä¢	Nombre total d‚Äôactivit√©s planifi√©es
‚Ä¢	Taux de couverture global (issu du module ad√©quation)
Ces valeurs sont g√©n√©r√©es par une vue ou une fonction Supabase (sites_stats_view).
________________________________________
üîπ 3.5 Int√©gration inter-modules
Module	Interaction
RH Collaborateurs	Rattachement obligatoire √† un site
Affaires & Activit√©s	Chaque enregistrement doit r√©f√©rencer un site
Planification Gantt	Filtrage principal par site
Ad√©quation charge / comp√©tence	Calculs par site
Suivi Projets	Vue regroup√©e par site
________________________________________
üîπ 3.6 Import / Export
‚Ä¢	Import Excel/CSV :
o	Colonnes : nom, code_site, responsable, statut
o	Validation du code unique et coh√©rence responsable
‚Ä¢	Export Excel/CSV :
o	Tous les champs + effectifs et affaires li√©s
________________________________________
4Ô∏è‚É£ Mod√®le de donn√©es (Supabase)
Table : sites
Champ	Type	Description
id	uuid	Identifiant unique
code_site	text	Code court, unique (ex. ‚ÄúE-03A‚Äù)
nom	text	Nom complet
responsable_id	uuid	Lien ‚Üí ressources.id
rempla√ßant_id	uuid (nullable)	Lien ‚Üí ressources.id
statut	text	Actif / En pause / Ferm√©
commentaires	text	Notes internes
date_creation	timestamp	Cr√©ation
created_by	uuid	Cr√©ateur
Vue / table d√©riv√©e : sites_stats_view
Champ	Type	Description
site_id	uuid	Lien ‚Üí sites.id
nb_collaborateurs	int	Collaborateurs actifs li√©s
nb_affaires	int	Affaires ouvertes
nb_activites	int	Activit√©s planifi√©es
couverture_globale	float	% couverture par comp√©tence
date_maj	timestamp	Mise √† jour automatique
________________________________________
5Ô∏è‚É£ R√®gles m√©tiers
‚Ä¢	Code site obligatoire et unique.
‚Ä¢	Responsable principal = collaborateur actif obligatoire.
‚Ä¢	Site ‚Äúferm√©‚Äù : bloqu√© dans tous les √©crans de planification.
‚Ä¢	Suppression physique interdite, archivage uniquement.
‚Ä¢	Les statistiques sont mises √† jour automatiquement (cron Supabase).
________________________________________
6Ô∏è‚É£ Crit√®res d‚Äôacceptation
ID	Crit√®re	Validation
SITE-01	Cr√©ation site avec code unique et responsable actif	‚úÖ
SITE-02	Statut Ferm√© bloque la planification	‚úÖ
SITE-03	Sites visibles dans RH / Planif / Ad√©quation	‚úÖ
SITE-04	Import Excel valide code et coh√©rence responsable	‚úÖ
SITE-05	Vue stats correcte (collaborateurs + affaires)	‚úÖ
SITE-06	Export complet CSV / Excel	‚úÖ
SITE-07	Interface fluide et responsive	‚úÖ
________________________________________
7Ô∏è‚É£ Stack technique
√âl√©ment	Lib / Outil
Backend	Supabase (sites, sites_stats_view)
Frontend	Next.js + Tailwind
Forms	React Hook Form + Zod
Charts	Recharts (vue stats)
Export / Import	SheetJS
Auth	Supabase Session (RH / Admin / Planificateur)
________________________________________
8Ô∏è‚É£ UI / Composants
Composant	R√¥le
SitesTable	Liste principale
SiteFormModal	Cr√©ation / modification
SiteStatsCard	KPIs effectif / affaires / couverture
FilterBar	Filtres code / statut / responsable
ExportButton	Export Excel
ImportButton	Import Excel

PRD ‚Äî Module Sites
Auteur : Fred Baudry
Version : 1.1 (version √©pur√©e et int√©gr√©e)
Stack : Next.js 15 / Supabase / Tailwind / Recharts
Objectif principal :
G√©rer la base des sites (unit√©s op√©rationnelles) servant de cl√© hi√©rarchique dans tous les modules ‚Äî RH, planification, suivi projets et ad√©quation.
________________________________________
1Ô∏è‚É£ Objectif
Cr√©er un module simple et robuste pour :
‚Ä¢	Cr√©er / modifier / archiver les sites ;
‚Ä¢	Assigner un responsable principal et un rempla√ßant ;
‚Ä¢	Suivre l‚Äô√©tat op√©rationnel du site (actif / en pause / ferm√©) ;
‚Ä¢	Servir de r√©f√©rence centrale pour les collaborateurs, affaires et activit√©s.
________________________________________
2Ô∏è‚É£ Utilisateurs cibles
R√¥le	Acc√®s	Actions
Administratif / RH	Acc√®s total	CRUD complet sur les sites
Planificateur	Lecture + √©dition limit√©e	Modifie le responsable ou statut
Responsable de site	Lecture seule	Voit uniquement son site et ses donn√©es
Direction	Lecture globale	Vue multi-sites (lecture seule)
________________________________________
3Ô∏è‚É£ Fonctionnalit√©s principales
üîπ 3.1 Tableau des sites
‚Ä¢	Vue synth√©tique :
o	Nom du site
o	Code site (cl√© unique ex. ‚ÄúE-03A‚Äù)
o	Responsable principal
o	Rempla√ßant (optionnel)
o	Nombre de collaborateurs actifs (auto-calcul)
o	Nombre d‚Äôaffaires en cours (auto-calcul)
o	Statut (Actif / En pause / Ferm√©)
‚Ä¢	Filtres rapides : par statut, responsable ou code site.
‚Ä¢	Recherche libre sur nom ou code.
‚Ä¢	Boutons :
o	‚Äú+ Nouveau site‚Äù (cr√©ation)
o	‚ÄúExporter CSV / Excel‚Äù.
________________________________________
üîπ 3.2 Cr√©ation / modification d‚Äôun site
Formulaire all√©g√© :
‚Ä¢	Champs obligatoires :
o	Nom du site
o	Code site (unique)
o	Responsable principal (collaborateur actif)
o	Statut (Actif / En pause / Ferm√©)
‚Ä¢	Champs facultatifs :
o	Rempla√ßant (autre collaborateur actif)
o	Commentaire libre
‚Ä¢	Validation :
o	Code site unique.
o	Responsable actif obligatoire.
________________________________________
üîπ 3.3 Gestion du statut
Statut	Description	Effet
Actif	Site op√©rationnel	Visible partout
En pause	Activit√© temporairement suspendue	Avertissement dans la Gantt
Ferm√©	Site termin√©	Archiv√©, plus d‚Äôaffectation possible
Lors du passage √† ‚ÄúFerm√©‚Äù :
‚Ä¢	Aucune nouvelle affectation possible.
‚Ä¢	Les activit√©s et affaires en cours sont cl√¥tur√©es automatiquement (statut = termin√©).
________________________________________
üîπ 3.4 Statistiques de base
Chaque site agr√®ge automatiquement :
‚Ä¢	Effectif actif (ressources li√©es)
‚Ä¢	Nombre d‚Äôaffaires ouvertes
‚Ä¢	Nombre total d‚Äôactivit√©s planifi√©es
‚Ä¢	Taux de couverture global (issu du module ad√©quation)
Ces valeurs sont g√©n√©r√©es par une vue ou une fonction Supabase (sites_stats_view).
________________________________________
üîπ 3.5 Int√©gration inter-modules
Module	Interaction
RH Collaborateurs	Rattachement obligatoire √† un site
Affaires & Activit√©s	Chaque enregistrement doit r√©f√©rencer un site
Planification Gantt	Filtrage principal par site
Ad√©quation charge / comp√©tence	Calculs par site
Suivi Projets	Vue regroup√©e par site
________________________________________
üîπ 3.6 Import / Export
‚Ä¢	Import Excel/CSV :
o	Colonnes : nom, code_site, responsable, statut
o	Validation du code unique et coh√©rence responsable
‚Ä¢	Export Excel/CSV :
o	Tous les champs + effectifs et affaires li√©s
________________________________________
4Ô∏è‚É£ Mod√®le de donn√©es (Supabase)
Table : sites
Champ	Type	Description
id	uuid	Identifiant unique
code_site	text	Code court, unique (ex. ‚ÄúE-03A‚Äù)
nom	text	Nom complet
responsable_id	uuid	Lien ‚Üí ressources.id
rempla√ßant_id	uuid (nullable)	Lien ‚Üí ressources.id
statut	text	Actif / En pause / Ferm√©
commentaires	text	Notes internes
date_creation	timestamp	Cr√©ation
created_by	uuid	Cr√©ateur
Vue / table d√©riv√©e : sites_stats_view
Champ	Type	Description
site_id	uuid	Lien ‚Üí sites.id
nb_collaborateurs	int	Collaborateurs actifs li√©s
nb_affaires	int	Affaires ouvertes
nb_activites	int	Activit√©s planifi√©es
couverture_globale	float	% couverture par comp√©tence
date_maj	timestamp	Mise √† jour automatique
________________________________________
5Ô∏è‚É£ R√®gles m√©tiers
‚Ä¢	Code site obligatoire et unique.
‚Ä¢	Responsable principal = collaborateur actif obligatoire.
‚Ä¢	Site ‚Äúferm√©‚Äù : bloqu√© dans tous les √©crans de planification.
‚Ä¢	Suppression physique interdite, archivage uniquement.
‚Ä¢	Les statistiques sont mises √† jour automatiquement (cron Supabase).
________________________________________
6Ô∏è‚É£ Crit√®res d‚Äôacceptation
ID	Crit√®re	Validation
SITE-01	Cr√©ation site avec code unique et responsable actif	‚úÖ
SITE-02	Statut Ferm√© bloque la planification	‚úÖ
SITE-03	Sites visibles dans RH / Planif / Ad√©quation	‚úÖ
SITE-04	Import Excel valide code et coh√©rence responsable	‚úÖ
SITE-05	Vue stats correcte (collaborateurs + affaires)	‚úÖ
SITE-06	Export complet CSV / Excel	‚úÖ
SITE-07	Interface fluide et responsive	‚úÖ
________________________________________
7Ô∏è‚É£ Stack technique
√âl√©ment	Lib / Outil
Backend	Supabase (sites, sites_stats_view)
Frontend	Next.js + Tailwind
Forms	React Hook Form + Zod
Charts	Recharts (vue stats)
Export / Import	SheetJS
Auth	Supabase Session (RH / Admin / Planificateur)
________________________________________
8Ô∏è‚É£ UI / Composants
Composant	R√¥le
SitesTable	Liste principale
SiteFormModal	Cr√©ation / modification
SiteStatsCard	KPIs effectif / affaires / couverture
FilterBar	Filtres code / statut / responsable
ExportButton	Export Excel
ImportButton	Import Excel


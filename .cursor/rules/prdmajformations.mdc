---
alwaysApply: true
---
üß© PRD ‚Äî Module ‚ÄúPlan de Formation‚Äù

(ancien Plan Pr√©visionnel)

1Ô∏è‚É£ Objectif g√©n√©ral

Centraliser et automatiser la gestion annuelle du plan de formation :

D√©tecter les formations arrivant √† √©ch√©ance (certifications, habilitations, recyclages).

G√©n√©rer un plan pr√©visionnel Y+1 regroupant toutes les ressources concern√©es.

Permettre la validation unitaire ou globale, transformant le plan pr√©visionnel en Plan de Formation officiel.

Figer le plan (snapshot) pour suivre l‚Äôavancement et le budget au cours de l‚Äôann√©e.

Autoriser l‚Äôajout de formations hors plan avec suivi par avenant.

2Ô∏è‚É£ P√©rim√®tre fonctionnel
Inclus :

G√©n√©ration automatique Y+1 depuis les dates d‚Äôexpiration des formations.

Page de pr√©paration (‚ÄúPlan Pr√©visionnel‚Äù).

Validation unitaire et globale (‚ÄúPlan pr√©visionnel valid√©‚Äù).

Page du plan officiel (‚ÄúPlan de Formation‚Äù).

Gel (snapshot) des volumes et co√ªts √† la validation globale.

Suivi des formations planifi√©es, r√©alis√©es, annul√©es.

Statistiques globales, par cat√©gorie et par trimestre.

Gestion financi√®re (pr√©vu / engag√© / r√©alis√© / √©cart).

Int√©gration des formations ‚Äúhors plan‚Äù (en cours d‚Äôann√©e).

Exclus :

Gestion RH compl√®te (hors p√©rim√®tre : contrats, carri√®res).

Gestion de contenu e-learning (non pr√©vue ici).

G√©n√©ration automatique de convocations (v2).

3Ô∏è‚É£ Terminologie
Terme	D√©finition
Plan Pr√©visionnel	Page de pr√©paration Y+1 : g√©n√©ration, validation.
Plan de Formation	Plan officiel valid√©, gel√© pour suivi annuel.
Hors plan	Formation ajout√©e apr√®s validation du plan (non incluse dans la baseline).
Baseline (Snapshot)	Version fig√©e du plan valid√©, servant de r√©f√©rence budg√©taire et statistique.
Avenant	Ajout officiel d‚Äô√©l√©ments hors plan au plan existant (cr√©ation d‚Äôune nouvelle version).
4Ô∏è‚É£ Mod√®le de donn√©es
4.1 Catalogue des formations
CatalogueFormations(
  formation_id uuid primary key,
  intitule text,
  validite_mois int,
  duree_jours int,
  category text,           -- SECURITE, QUALITE, AUTO, etc.
  organisme_id uuid,       -- ref Organismes
  tarif_unitaire numeric,
  tarif_groupe numeric,
  min_participants int,
  max_participants int
)

4.2 Historique des formations par ressource
RessourceFormations(
  id uuid primary key,
  resource_id uuid,
  formation_id uuid,
  date_obtention date,
  date_expiration date,
  mode text check (mode in ('INTERNE','EXTERNE')),
  preuve_url text
)

4.3 Plan de Formation (table principale)
PlanFormations(
  id uuid primary key,
  annee int,
  resource_id uuid,
  formation_id uuid,
  mois_cible int,
  trimestre_cible int,
  category text,
  source text check (source in ('ECHEANCE','MANUEL_HORS_PLAN')),
  phase text check (phase in ('PREVISIONNEL','PLAN')) default 'PREVISIONNEL',
  statut text check (statut in ('EN_ATTENTE_VALIDATION','VALIDE','REJETE','PLANIFIE','REALISE','ANNULE')),
  session_id uuid null,
  cost_planned numeric,
  cout_estime numeric,
  baseline_version int default 0,
  validated_at timestamptz null,
  created_by uuid,
  created_at timestamptz default now(),
  updated_at timestamptz
);


üîí Contraintes

Unique (annee, resource_id, formation_id)

Si phase='PLAN' ‚áí statut ‚àâ ('EN_ATTENTE_VALIDATION','REJETE')

4.4 Snapshots (baselines gel√©es)
PlanSnapshots(
  id uuid primary key,
  annee int,
  version int,
  committed_at timestamptz,
  committed_by uuid,
  tot_count int,
  tot_cost numeric,
  by_category jsonb,   -- ex: {"SECURITE": {"count":45,"cost":24000}, ...}
  by_quarter jsonb,
  by_month jsonb,
  note text
);

4.5 Journal financier (ledger)
TrainingFinanceLedger(
  id uuid primary key,
  plan_item_id uuid references PlanFormations(id),
  annee int,
  type text check (type in ('PLANNED','COMMITTED','ACTUAL','ADJUSTMENT')),
  amount numeric,
  currency text default 'EUR',
  date date,
  source text,
  meta jsonb
);

4.6 Avenants (int√©gration de hors plan)
PlanChangeOrders(
  id uuid primary key,
  annee int,
  version_from int,
  version_to int,
  created_at timestamptz default now(),
  created_by uuid,
  reason text,
  delta_count int,
  delta_cost numeric,
  breakdown jsonb
);

5Ô∏è‚É£ Processus & r√®gles de gestion
√âtape 1 ‚Äî G√©n√©ration du Plan Pr√©visionnel

L‚Äôutilisateur clique sur ‚ÄúG√©n√©rer le pr√©visionnel Y+1‚Äù.

L‚Äôoutil d√©tecte :

toutes les formations √† expiration sur [01/01/Y+1 ; 31/12/Y+1];

les formations obligatoires jamais r√©alis√©es.

Cr√©e des lignes phase='PREVISIONNEL', statut='EN_ATTENTE_VALIDATION'.

Calcule mois_cible √† J-60 avant expiration.

Classe les lignes par mois et trimestre.

√âtape 2 ‚Äî Validation unitaire

Dans la page ‚ÄúPlan Pr√©visionnel‚Äù, l‚Äôutilisateur peut :

Valider une ligne (statut = VALIDE, validated_at=now()),

Rejeter une ligne (statut = REJETE),

Ajouter une ligne Hors Plan (source=MANUEL_HORS_PLAN, statut=EN_ATTENTE_VALIDATION).

√âtape 3 ‚Äî Validation globale (‚ÄúPlan pr√©visionnel valid√©‚Äù)

Action principale :

S√©lectionne toutes les lignes phase='PREVISIONNEL' AND statut='VALIDE'.

Les bascule en phase='PLAN'.

Calcule totaux global / par cat√©gorie / trimestre.

Cr√©e un PlanSnapshots(version=n+1).

Copie cost_planned sur chaque ligne (tarif actuel).

Enregistre baseline_version=version.

üîí √Ä partir de l√† :

Le volume total et les co√ªts sont fig√©s.

Seules les formations Hors plan restent modifiables.

√âtape 4 ‚Äî Suivi d‚Äôavancement

Statuts √©volutifs :

PLANIFIE ‚Üí formation rattach√©e √† une session,

REALISE ‚Üí session termin√©e (maj historique RessourceFormations),

ANNULE ‚Üí annul√©e (option replanifier).

Calculs :

Couverture = REALISE / total_baseline

Avancement = (PLANIFIE + REALISE) / total_baseline

Consommation budget = Œ£(ledger.ACTUAL) / tot_cost_baseline

√âcart budget = (ACTUAL ‚Äì PLANNED)

Vue par mois/trimestre : avancement & d√©rives.

√âtape 5 ‚Äî Avenants

En cours d‚Äôann√©e :

Les Hors plan restent phase='PREVISIONNEL'.

Pour les int√©grer, on cr√©e un avenant :

Nouvelle version de snapshot.

Recalcul des totaux.

Mise √† jour baseline_version des lignes incorpor√©es.

Les versions s‚Äôencha√Ænent : v1 (plan initial), v2 (apr√®s avenant), etc.

6Ô∏è‚É£ KPIs & Reporting
Indicateur	D√©finition	Fr√©quence
Taux d‚Äôavancement	(Planifi√© + R√©alis√©) / Baseline	Temps r√©el
Taux de couverture	R√©alis√© / Baseline	Temps r√©el
Budget engag√© (‚Ç¨)	Œ£(COMMITTED)	Temps r√©el
Budget consomm√© (‚Ç¨)	Œ£(ACTUAL)	Temps r√©el
√âcart (‚Ç¨)	ACTUAL ‚Äì PLANNED	Temps r√©el
Hors plan (%)	Nb hors baseline / Total lignes	Mensuel
D√©rive planifi√©e	Nb lignes en retard (J-30)	Hebdomadaire
7Ô∏è‚É£ Interfaces & UX
Page Plan Pr√©visionnel

Actions :

‚ÄúG√©n√©rer pr√©visionnel Y+1‚Äù

‚ÄúValider s√©lection‚Äù

‚ÄúRejeter s√©lection‚Äù

‚ÄúAjouter Hors plan‚Äù

‚ÄúPlan pr√©visionnel valid√©‚Äù (gros bouton principal)

Vues :

Liste filtrable (Site, Cat√©gorie, Statut, Source)

Groupements : par mois / trimestre

Badge ‚ÄúHors plan‚Äù

√Ä la validation globale :

Pop-up r√©sum√© : ‚Äú312 formations valid√©es, 145 500 ‚Ç¨ ‚Äî Plan de Formation Y+1 cr√©√© (v1)‚Äù

Page Plan de Formation

Bandeau ent√™te : ‚ÄúPlan de Formation Y (v1 ‚Äì valid√© le 15/11/2025)‚Äù.

KPI cards :

Couverture (%)

Avancement (%)

Budget engag√© (‚Ç¨)

Budget consomm√© (‚Ç¨)

Graphiques :

Barres empil√©es par cat√©gorie

Burndown mensuel

Courbe budget (pr√©vu / engag√© / r√©alis√©)

Actions :

G√©n√©rer sessions automatiques

Cr√©er avenant

Export PDF/CSV (plan complet ou baseline)

8Ô∏è‚É£ API principales
Endpoint	M√©thode	Description
/training/previsionnel/generate?annee=YYYY	POST	D√©tection √©ch√©ances + cr√©ation lignes
/training/previsionnel/validate	POST	Validation unitaire (ids[])
/training/previsionnel/reject	POST	Rejet (ids[], reason)
/training/previsionnel/commit-plan	POST	Cr√©ation baseline, passage √† phase='PLAN'
/training/plan/kpis?annee=&version=	GET	Retourne indicateurs & ratios
/training/ledger	POST	Ajout √©criture (ACTUAL, COMMITTED, etc.)
/training/plan/change-order	POST	Cr√©ation avenant
9Ô∏è‚É£ R√®gles d‚Äôacc√®s
R√¥le	Droits
RH / Administratif	G√©n√©ration, validation, commit, avenant
Manager (N6+)	Validation unitaire sur son p√©rim√®tre
Responsable de site (N4/N5)	Lecture et ajout Hors plan
Utilisateur	Consultation de ses formations et √©ch√©ances
üîü Crit√®res d‚Äôacceptation

‚úÖ Le plan se g√©n√®re sans doublons et inclut 100 % des formations √©ch√©ant Y+1.

‚úÖ Le bouton ‚ÄúPlan pr√©visionnel valid√©‚Äù fige les volumes et cr√©e le snapshot.

‚úÖ Les Hors plan n‚Äôaffectent pas les totaux fig√©s (baseline) tant qu‚Äôaucun avenant n‚Äôest cr√©√©.

‚úÖ Les KPIs se recalculent en temps r√©el via les statuts et le ledger.

‚úÖ Le co√ªt total fig√© reste identique sur toute l‚Äôann√©e (sauf avenant).

‚úÖ Export CSV et PDF op√©rationnels pour Plan Pr√©visionnel et Plan de Formation.

‚úÖ Historique des versions (v1, v2‚Ä¶) consultable depuis Plan de Formation.
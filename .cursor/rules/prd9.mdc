---
alwaysApply: true
---
ğŸ§­ PRD â€” Module Interlocuteurs Clients
Auteur : Fred Baudry
Version : 1.0
Stack : Next.js 15 / Supabase / Tailwind / Recharts / SMTP (mail auto)
Objectif principal :
Centraliser la gestion des interlocuteurs clients (personnes & entreprises), permettre leur liaison directe aux affaires, dÃ©finir leurs rÃ´les, et enregistrer leurs interactions pour exploitation dans les modules Gantt, Claims, et Reporting.
________________________________________
1ï¸âƒ£ Objectif
CrÃ©er une base claire et relationnelle pour :
â€¢	GÃ©rer les clients (entitÃ© juridique + contacts associÃ©s),
â€¢	Lier les contacts Ã  une ou plusieurs affaires,
â€¢	Associer un ou plusieurs rÃ´les (Technique, Administratif, Facturation, etc.),
â€¢	Disposer dâ€™une fiche interlocuteur complÃ¨te (coordonnÃ©es, fonction, historique),
â€¢	Suivre les Ã©changes clÃ©s (notes, mails, appels, rÃ©unions),
â€¢	Exploiter ces donnÃ©es dans les formulaires de suivi, claims, et reportings dâ€™affaires.
________________________________________
2ï¸âƒ£ Utilisateurs cibles
RÃ´le	AccÃ¨s	Actions
ChargÃ© dâ€™Affaires	AccÃ¨s complet Ã  ses clients & affaires liÃ©es	CRUD + liaisons
Planificateur / Conducteur	Lecture + contact rapide	Voir les interlocuteurs de lâ€™affaire
Direction / PMO	Lecture globale	Vue multi-sites, export complet
Administratif	Lecture + MAJ facturation	Voir et modifier les contacts de gestion
Support / RH / Maintenance	Lecture restreinte	Lecture via liaison affaire uniquement
________________________________________
3ï¸âƒ£ FonctionnalitÃ©s principales
ğŸ”¹ 3.1 Base â€œClientsâ€
â€¢	EntitÃ© principale (sociÃ©tÃ© / organisme) :
o	Nom entreprise
o	SIRET (optionnel)
o	Adresse siÃ¨ge
o	TÃ©lÃ©phone principal
o	Email gÃ©nÃ©rique
o	CatÃ©gorie : MOA / MOE / Exploitant / Autre
o	Statut actif/inactif
â€¢	Vue tableau triable + recherche rapide.
ğŸ”¹ 3.2 Base â€œInterlocuteursâ€
Chaque contact appartient Ã  une entreprise client (FK) :
Champ	Description
Nom / PrÃ©nom	IdentitÃ©
Fonction	Titre (Responsable technique, ChargÃ© dâ€™exploitation, etc.)
Email	Pro + secondaire (si besoin)
TÃ©lÃ©phone	Fixe / mobile
DisponibilitÃ©	CrÃ©neau (ex. 8hâ€“17h)
Type dâ€™interlocuteur	Technique / Administratif / SÃ©curitÃ© / Facturation / Autre
Site principal	Option : rattachement site
Notes	Libre
Gestion :
â€¢	CRUD complet (ajout, modification, archivage).
â€¢	Tag â€œprincipalâ€ si unique pour une affaire donnÃ©e.
â€¢	Photo ou carte de visite (upload possible).
________________________________________
ğŸ”¹ 3.3 Liaison aux Affaires
â€¢	Une affaire peut avoir plusieurs interlocuteurs clients.
â€¢	Une personne peut Ãªtre liÃ©e Ã  plusieurs affaires (ex. MOE commun).
â€¢	Liaison via table de jointure affaires_interlocuteurs.
Dans chaque affaire :
â€¢	Onglet â€œInterlocuteursâ€ :
o	Liste des contacts liÃ©s.
o	RÃ´le dans lâ€™affaire :
ï‚§	Technique / Administratif / Facturation / Exploitant / RÃ©ception / RÃ©clamation / Autre
o	Checkbox â€œcontact principalâ€ (1 par rÃ´le).
o	Bouton â€œContacterâ€ â†’ ouvre mail ou renvoi Ã  Outlook.
o	Historique Ã©changes rÃ©cents (notes internes + synchronisation mail optionnelle).
Synchronisation :
â€¢	Si un contact est dÃ©sactivÃ© â†’ suppression logique du lien, pas de perte historique.
â€¢	RÃ©cupÃ©ration automatique dans les formulaires liÃ©s Ã  lâ€™affaire (ex. Claim â†’ â€œchoisir interlocuteur clientâ€).
________________________________________
ğŸ”¹ 3.4 Suivi & Historique dâ€™Ã©changes
â€¢	Section â€œHistoriqueâ€ par interlocuteur :
o	Date, type dâ€™interaction (appel, mail, rÃ©union, visite site, claim),
o	Notes internes, fichiers associÃ©s (CR, photo, doc).
â€¢	Enregistrement manuel ou via dÃ©clencheur automatique (ex. Claim crÃ©Ã© â†’ ajout â€œsignalementâ€).
â€¢	Chronologie inversÃ©e (dernier en haut).
â€¢	Export CSV/PDF possible pour audit client.
________________________________________
ğŸ”¹ 3.5 IntÃ©gration multi-modules
Module	IntÃ©gration	Description
Affaires	Liaison directe	Chaque affaire contient les interlocuteurs liÃ©s
Claims	Auto-rattachement	Lâ€™auteur client du claim peut Ãªtre sÃ©lectionnÃ© depuis la liste
RemontÃ©es site / maintenance	Optionnel	Permet dâ€™associer un contact client tÃ©moin ou rÃ©fÃ©rent
Dashboard Affaires	KPI	Nb dâ€™interlocuteurs par affaire, ratio actif/inactif, contact principal renseignÃ©
Power Automate / Mailer	Notifications	Utilise les emails associÃ©s pour envoi de compte-rendus, notifications, claims, etc.
________________________________________
4ï¸âƒ£ ModÃ¨le de donnÃ©es (Supabase)
Table clients
Champ	Type	Description
id	uuid	PK
nom_client	text	Nom de la sociÃ©tÃ©
siret	text	Optionnel
adresse	text	Adresse principale
code_postal	text	
ville	text	
telephone	text	NumÃ©ro principal
email	text	Email gÃ©nÃ©rique
categorie	text	MOA / MOE / Exploitant / Maintenance / Autre
actif	bool	true par dÃ©faut
date_creation	timestamp	Ajout
created_by	uuid	Utilisateur crÃ©ateur
________________________________________
Table interlocuteurs
Champ	Type	Description
id	uuid	PK
client_id	uuid	FK â†’ clients
nom	text	Nom
prenom	text	PrÃ©nom
fonction	text	RÃ´le ou fonction
type_interlocuteur	text	Technique / Administratif / Facturation / Autre
email	text	
telephone	text	
disponibilite	text	Texte libre ou plage horaire
site_id	uuid (nullable)	Lien vers site (si contact localisÃ©)
actif	bool	Par dÃ©faut true
notes	text	Observations internes
photo_url	text	Option
date_creation	timestamp	Ajout
created_by	uuid	Utilisateur crÃ©ateur
________________________________________
Table affaires_interlocuteurs
Champ	Type	Description
id	uuid	PK
affaire_id	uuid	FK â†’ affaires
interlocuteur_id	uuid	FK â†’ interlocuteurs
role_affaire	text	Technique / Administratif / Facturation / etc.
principal	bool	true si contact principal
actif	bool	true par dÃ©faut
date_liaison	timestamp	Date dâ€™association
created_by	uuid	Utilisateur crÃ©ateur
________________________________________
Table interactions_client
Champ	Type	Description
id	uuid	PK
interlocuteur_id	uuid	FK â†’ interlocuteurs
affaire_id	uuid	FK â†’ affaires
type_interaction	text	Appel / Mail / RÃ©union / Claim / Autre
description	text	Note de lâ€™Ã©change
fichier_url	text	Optionnel
date_interaction	timestamp	Date de lâ€™Ã©vÃ©nement
created_by	uuid	Auteur
________________________________________
5ï¸âƒ£ RÃ¨gles mÃ©tier
â€¢	Un client actif peut avoir plusieurs contacts actifs, chacun liÃ© Ã  plusieurs affaires.
â€¢	Si un contact est dÃ©sactivÃ© â†’ invisible en sÃ©lection mais conservÃ© dans lâ€™historique.
â€¢	Chaque affaire doit avoir au moins un interlocuteur principal par rÃ´le critique (Technique, Facturation).
â€¢	Historique interactions conservÃ© indÃ©finiment.
â€¢	Une interaction liÃ©e Ã  un claim ou une rÃ©union est auto-crÃ©Ã©e Ã  la validation de lâ€™Ã©vÃ©nement.
â€¢	Suppression physique interdite, archivage logique.
________________________________________
6ï¸âƒ£ CritÃ¨res dâ€™acceptation
ID	CritÃ¨re	Validation
CLI-01	CRUD client et interlocuteur fonctionnel	âœ…
CLI-02	Liaison affaire â†” interlocuteur	âœ…
CLI-03	Contact principal par rÃ´le	âœ…
CLI-04	Historique interactions complet	âœ…
CLI-05	Contact dÃ©sactivÃ© = masquÃ© mais non supprimÃ©	âœ…
CLI-06	IntÃ©gration claims et Gantt	âœ…
CLI-07	Recherche & filtres rapides	âœ…
CLI-08	Export CSV/PDF correct	âœ…
________________________________________
7ï¸âƒ£ Stack technique
Ã‰lÃ©ment	Lib / Outil
Backend	Supabase (clients, interlocuteurs, affaires_interlocuteurs, interactions_client)
Frontend	Next.js + Tailwind
Forms	React Hook Form + Zod
Export	SheetJS / PDFKit
Auth	Supabase Session
Notifications	SMTP / Power Automate (mail auto CR ou Claim)
________________________________________
8ï¸âƒ£ UI / Composants
Composant	Description
ClientsTable	Liste des entreprises clientes
InterlocuteursTable	Liste filtrÃ©e des contacts
InterlocuteurFormModal	CRUD contact
AffaireInterlocuteursTab	Liste + ajout contact dans une affaire
InteractionTimeline	Historique Ã©changes chronologique
QuickContactCard	Carte contact (appel / mail / notes)
SearchClientBar	Recherche + filtre (site, affaire, catÃ©gorie)
ContactBadge	Badge rÃ´le (Technique / Admin / Facturation)
________________________________________
9ï¸âƒ£ IntÃ©grations
Module	Interaction
Affaires	Liaison multiple + rÃ´le contact principal
Claims	SÃ©lection interlocuteur client concernÃ©
Gantt	AccÃ¨s rapide contact client associÃ© Ã  lâ€™affaire
Maintenance	PossibilitÃ© dâ€™ajouter un interlocuteur client â€œrÃ©fÃ©rent techniqueâ€
Mail / Digest	GÃ©nÃ©ration auto de listes destinataires par affaire
________________________________________
ğŸ”Ÿ Exemple de scÃ©nario
ğŸ§© Affaire A : â€œModernisation poste HTA â€“ Site E-03Aâ€
â€¢	Client = EDF RÃ©seaux
â€¢	Interlocuteurs :
o	Jean Dupont â†’ Responsable Technique (principal)
o	Claire Simon â†’ Administratif
o	Hugo Leroy â†’ Exploitant site
â€¢	Liaison :
o	Affaire A â†” Jean Dupont (Technique principal)
o	Affaire A â†” Claire Simon (Administratif)
o	Affaire A â†” Hugo Leroy (Exploitant)
â€¢	Une rÃ©union de suivi â†’ crÃ©e interaction type â€œRÃ©unionâ€ liÃ©e Ã  Jean Dupont + Affaire A.
â€¢	Claim signalÃ© â†’ ajoute â€œClaim client â€“ EDFâ€ dans historique.


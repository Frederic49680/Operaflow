---
alwaysApply: true
---
ğŸ§­ PRD â€” Module RÃ©clamations / Claims
Auteur : Fred Baudry
Version : 1.0
Stack : Next.js 15 / Supabase / Tailwind / Recharts / SMTP (notifications)
________________________________________
1ï¸âƒ£ Objectif
CrÃ©er un module central de gestion des rÃ©clamations (internes & clients), permettant de :
â€¢	signaler, qualifier et suivre les claims liÃ©s aux affaires, sites ou tÃ¢ches,
â€¢	gÃ©rer les Ã©tats, responsabilitÃ©s et valeurs financiÃ¨res,
â€¢	stocker les justificatifs (documents, photos, mails),
â€¢	automatiser les notifications et suivis dâ€™avancement,
â€¢	et alimenter les dashboards financiers / opÃ©rationnels.
âš™ï¸ Ce module fait le lien entre les remontÃ©es terrain, les affaires, les clients et les plans de charge.
________________________________________
2ï¸âƒ£ Typologie
Type	Description	Exemples
Interne	RÃ©clamation gÃ©nÃ©rÃ©e par nos Ã©quipes (retard, non-conformitÃ©, erreur planif)	DÃ©lai fournisseur, erreur exÃ©cution
Client	RÃ©clamation Ã©mise ou subie vis-Ã -vis du client	Retard chantier, travaux supplÃ©mentaires, blocage accÃ¨s
Fournisseur / Sous-traitant	RÃ©clamation envers un tiers	Retard livraison, prestation non conforme
________________________________________
3ï¸âƒ£ Utilisateurs cibles
RÃ´le	AccÃ¨s	Actions
Responsable de site / conducteur	CrÃ©ation / MAJ	CrÃ©e ou signale une rÃ©clamation
ChargÃ© dâ€™Affaires	Validation / suivi	Valide la rÃ©clamation et envoie vers client
Planificateur	Lecture	Voit impact planning / Gantt
Direction / PMO	Lecture + pilotage	SynthÃ¨se, coÃ»t total, taux clÃ´ture
Administratif	Lecture + suivi financier	VÃ©rifie facturation et compensation
Client (option)	Lecture restreinte via rapport PDF	Peut recevoir les claims client validÃ©s
________________________________________
4ï¸âƒ£ FonctionnalitÃ©s principales
ğŸ”¹ 4.1 CrÃ©ation dâ€™une rÃ©clamation
Accessible depuis :
â€¢	Une affaire,
â€¢	Une tÃ¢che Gantt,
â€¢	Une remontÃ©e site,
â€¢	Ou la page â€œRÃ©clamationsâ€ directe.
Champs principaux :
Champ	Description	Obligatoire
Type	Interne / Client / Fournisseur	âœ…
Source	Affaire / TÃ¢che / Site / Maintenance	âœ…
Titre	RÃ©sumÃ© court	âœ…
Description	DÃ©tail de la rÃ©clamation	âœ…
Montant estimÃ© (â‚¬)	Valeur prÃ©visionnelle	âœ…
Responsable identifiÃ©	Interne / Client / Sous-traitant	âœ…
Date de dÃ©tection	Date du constat	âœ…
Impact planning	Oui / Non	âœ…
Impact financier	Oui / Non	âœ…
Statut	Ouvert / En analyse / ValidÃ© / Transmis / Clos	âœ…
PiÃ¨ces jointes	Photos, mails, justificatifs	-
Lien interlocuteur client	FK â†’ interlocuteur_id	Optionnel
Observations internes	Commentaire confidentiel	-
________________________________________
ğŸ”¹ 4.2 Workflow & Ã©tats
Statut	Description	Action principale
Ouvert	RÃ©clamation crÃ©Ã©e, en attente dâ€™analyse	Validation CA
En analyse	VÃ©rification des causes / responsabilitÃ©s	Ajout justificatifs
ValidÃ©	ConfirmÃ©e par CA, montant et impact figÃ©s	Notification client
Transmis	EnvoyÃ©e au client (mail / PDF joint)	Suivi rÃ©ponse
Clos	RÃ©solu ou compensÃ©	ArchivÃ©
Changement dâ€™Ã©tat journalisÃ© (table claim_history).
Chaque transition peut dÃ©clencher un mail automatique (Power Automate ou Supabase Function).
________________________________________
ğŸ”¹ 4.3 Gestion financiÃ¨re
â€¢	Montant estimÃ© : saisi Ã  la crÃ©ation.
â€¢	Montant final : validÃ© en clÃ´ture.
â€¢	Ã‰cart (â‚¬) = final â€“ estimÃ©.
â€¢	CatÃ©gorisation :
o	Retard chantier
o	Travaux supplÃ©mentaires
o	Non-conformitÃ© / SAV
o	MatÃ©riel / Sous-traitant
o	Autre
IntÃ©gration financiÃ¨re :
â€¢	AgrÃ©gation vers vue V_Dashboard_Affaires (total claim client, total interne).
â€¢	PossibilitÃ© dâ€™associer un code analytique (champ code_ana).
________________________________________
ğŸ”¹ 4.4 Suivi des rÃ©clamations
Vue principale :
â€¢	Tableau filtrable (type, statut, affaire, responsable, date, montant, site, client).
â€¢	Badges couleur :
o	ğŸŸ¢ Clos
o	ğŸŸ  En analyse
o	ğŸ”´ Ouvert / Transmis
â€¢	Colonnes principales :
o	NÂ° Claim, Affaire, Client, Type, Responsable, Montant estimÃ©/final, Statut, Date MAJ.
â€¢	Tri et recherche plein texte.
Filtres rapides :
â€¢	Par site / affaire
â€¢	Par statut
â€¢	Par type
â€¢	Par responsable
â€¢	Par client
________________________________________
ğŸ”¹ 4.5 Historique & piÃ¨ces jointes
Chaque claim garde son log complet :
â€¢	Changement dâ€™Ã©tat, montants, responsable, commentaires, fichiers.
â€¢	PiÃ¨ces jointes stockÃ©es dans Supabase Storage (PDF, photo, email, etc.).
â€¢	Historique affichÃ© sous forme de timeline (type â€œconversationâ€).
________________________________________
ğŸ”¹ 4.6 Reporting & intÃ©gration Dashboard
KPI gÃ©nÃ©rÃ©s automatiquement :
Indicateur	Description
Nb de claims ouverts / clos / en analyse	
Montant total rÃ©clamations (estimÃ© / final)	
Taux de clÃ´ture (%)	
DÃ©lai moyen de rÃ©solution	
Claims par type	
Claims par affaire / client / site	
Claims client transmis vs validÃ©s	
IntÃ©grÃ© dans :
â€¢	Dashboard Affaires (impact financier)
â€¢	Dashboard Terrain (claims du jour / semaine)
â€¢	Dashboard Direction (coÃ»t total, dÃ©rive cumulÃ©e)
________________________________________
5ï¸âƒ£ ModÃ¨le de donnÃ©es (Supabase)
Table claims
Champ	Type	Description
id	uuid	PK
affaire_id	uuid	FK â†’ affaires
site_id	uuid	FK â†’ sites
tache_id	uuid (nullable)	FK â†’ planning_taches
interlocuteur_id	uuid (nullable)	FK â†’ interlocuteurs
type	text	Interne / Client / Sous-traitant
titre	text	Titre court
description	text	DÃ©tail complet
categorie	text	Type de cause
montant_estime	numeric	â‚¬
montant_final	numeric	â‚¬
impact_financier	bool	
impact_planning	bool	
responsable	text	Interne / Client / Sous-traitant
statut	text	Ouvert / En analyse / ValidÃ© / Transmis / Clos
code_ana	text (nullable)	Code analytique
date_detection	date	
date_cloture	date (nullable)	
fichiers	jsonb[]	Liste piÃ¨ces jointes
commentaire_interne	text	Notes non partagÃ©es
created_by	uuid	
date_creation	timestamptz	
updated_at	timestamptz	
________________________________________
Table claim_history
Champ	Type	Description
id	uuid	PK
claim_id	uuid	FK â†’ claims
action	text	crÃ©ation / maj / changement Ã©tat
ancien_statut	text	
nouveau_statut	text	
valeur_avant	jsonb	snapshot
valeur_apres	jsonb	snapshot
date_action	timestamptz	
acteur_id	uuid	utilisateur
________________________________________
Table claim_comments
Champ	Type	Description
id	uuid	PK
claim_id	uuid	FK â†’ claims
auteur_id	uuid	FK â†’ utilisateurs
message	text	commentaire
fichier_url	text	(option)
date_commentaire	timestamptz	
________________________________________
6ï¸âƒ£ RÃ¨gles mÃ©tier
â€¢	Chaque claim doit Ãªtre rattachÃ© Ã  au moins une affaire.
â€¢	Un claim â€œclientâ€ doit avoir un interlocuteur client associÃ©.
â€¢	Un claim ne peut Ãªtre clos sans montant final.
â€¢	Notification automatique :
o	CrÃ©ation â†’ mail Ã  CA & Resp. Site
o	Passage â€œValidÃ©â€ â†’ mail Ã  client + CA
o	Passage â€œClosâ€ â†’ mail interne (Direction + Admin)
â€¢	Archivage automatique aprÃ¨s 12 mois de clÃ´ture.
â€¢	Aucun claim ne peut Ãªtre supprimÃ© (archivage logique uniquement).
________________________________________
7ï¸âƒ£ CritÃ¨res dâ€™acceptation
ID	CritÃ¨re	Validation
CLM-01	CRUD complet (crÃ©ation, MAJ, suivi)	âœ…
CLM-02	Workflow statuts + historique	âœ…
CLM-03	PiÃ¨ces jointes stockÃ©es et consultables	âœ…
CLM-04	Liaison Affaire / TÃ¢che / Client	âœ…
CLM-05	Notifications automatiques selon Ã©tat	âœ…
CLM-06	IntÃ©gration Dashboard correcte	âœ…
CLM-07	Temps chargement < 3 s	âœ…
CLM-08	Historique complet consultable	âœ…
CLM-09	Pas de suppression physique	âœ…
________________________________________
8ï¸âƒ£ UI / Composants
Composant	Description
ClaimsTable	Liste principale (tri, filtres, recherche)
ClaimFormModal	Formulaire crÃ©ation / MAJ
ClaimTimeline	Historique des statuts et actions
ClaimAttachments	Upload + preview fichiers
ClaimCommentSection	Discussion interne
ClaimBadge	Statut visuel
ClaimKpiCards	4 cartes KPI (ouverts, clos, en analyse, total â‚¬)
________________________________________
9ï¸âƒ£ IntÃ©grations inter-modules
Module	IntÃ©gration
Affaires	Claims liÃ©s, cumul montants dans bilan affaire
RemontÃ©e Site	Claim possible Ã  partir dâ€™une anomalie terrain
Interlocuteurs	Contact client associÃ©
Dashboard	Claims ouverts, coÃ»t total, durÃ©e moyenne
Gantt	Indicateur â€œimpact planningâ€ sur tÃ¢che
Maintenance	RÃ©clamation technique sur activitÃ© batterie
Mailing	Automatisation notifications / CR
________________________________________
ğŸ”Ÿ Exemples de cas dâ€™usage
Cas 1 : Claim interne
â€¢	Conducteur signale un retard fournisseur â†’ crÃ©e claim â€œInterne â€“ Retard matÃ©rielâ€.
â€¢	Montant estimÃ© 2 000 â‚¬.
â€¢	Planificateur marque impact planning = oui.
â€¢	Claim validÃ©, clos aprÃ¨s 5 jours.
Cas 2 : Claim client
â€¢	RemontÃ©e terrain indique blocage client (accÃ¨s interdit).
â€¢	Claim â€œClient â€“ Blocage dâ€™accÃ¨s chantierâ€ crÃ©Ã©, montant estimÃ© 3 500 â‚¬.
â€¢	ValidÃ© â†’ transmis au client (PDF auto).
â€¢	Clos aprÃ¨s rÃ©ception du bon de compensation.


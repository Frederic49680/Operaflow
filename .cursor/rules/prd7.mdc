---
alwaysApply: true
---
ğŸ§­ PRD â€” Module RemontÃ©e dâ€™Information Site & Reporting Quotidien
Auteur : Fred Baudry
Version : 1.2
Stack : Next.js 15 / Supabase / Tailwind / Recharts / Power Automate (notif)
Objectif principal :
CrÃ©er un module terrain connectÃ© Ã  la planification Gantt, permettant :
â€¢	la remontÃ©e quotidienne de lâ€™Ã©tat des tÃ¢ches,
â€¢	la gestion des blocages et suspensions,
â€¢	et la confirmation journaliÃ¨re des statuts rÃ©els avant bascule en reporting figÃ©.
________________________________________
1ï¸âƒ£ Objectif gÃ©nÃ©ral
Offrir une interface terrain rapide et fiable pour les responsables de site, permettant de :
â€¢	Mettre Ã  jour lâ€™Ã©tat rÃ©el des tÃ¢ches planifiÃ©es (en cours, terminÃ©e, bloquÃ©e, suspendueâ€¦).
â€¢	Enregistrer les causes de dÃ©rive et claims Ã©ventuels.
â€¢	Suspendre une activitÃ© (pause technique, attente, mÃ©tÃ©oâ€¦) sans consommer de temps mÃ©tal.
â€¢	Confirmer en fin de journÃ©e les statuts dÃ©clarÃ©s.
â€¢	Basculer automatiquement les tÃ¢ches â€œconfirmÃ©esâ€ vers un reporting figÃ© destinÃ© au planificateur et au tableau de bord.
________________________________________
2ï¸âƒ£ Utilisateurs cibles
RÃ´le	AccÃ¨s	Actions
Responsable de site	AccÃ¨s total sur ses chantiers	CrÃ©e / met Ã  jour / confirme les remontÃ©es
Chef de chantier / conducteur	Lecture + saisie partielle	Remonte lâ€™Ã©tat et les effectifs
Planificateur	Lecture + validation	Suit les confirmations et rÃ©percute dans la Gantt
ChargÃ© dâ€™Affaires	Lecture seule	Voit lâ€™Ã©tat rÃ©el des tÃ¢ches
Direction / PMO	Lecture reporting	Exploite les rapports consolidÃ©s
________________________________________
3ï¸âƒ£ FonctionnalitÃ©s principales
ğŸ”¹ 3.1 Vue du jour â€“ â€œMes tÃ¢ches du siteâ€
â€¢	Liste des tÃ¢ches planifiÃ©es sur le site pour aujourdâ€™hui.
â€¢	Colonnes :
| TÃ¢che | Affaire | CompÃ©tence | DÃ©but/Fin planifiÃ©e | Ã‰tat planifiÃ© | Ã‰tat rÃ©el | % Avancement | PrÃ©sents (rÃ©el / prÃ©vu) | Motif | Claim |
â€¢	Filtres :
o	Par site
o	Par responsable
o	Par statut rÃ©el (en cours / bloquÃ©e / terminÃ©e)
â€¢	IcÃ´nes :
o	ğŸ”´ BloquÃ©e
o	â¸ï¸ Suspendue
o	âœ… TerminÃ©e
o	â³ En attente de confirmation
________________________________________
ğŸ”¹ 3.2 RemontÃ©e quotidienne
Formulaire simplifiÃ© (prÃ©rempli depuis Gantt) :
Champ	Type	Obligatoire
Ã‰tat rÃ©el (radio)	Non lancÃ©e / En cours / TerminÃ©e / ReportÃ©e / ProlongÃ©e / BloquÃ©e / Suspendue	âœ…
% Avancement	Curseur (0â€“100)	âœ… si en cours
Nombre de ressources prÃ©sentes	Nombre (vs planifiÃ©es)	âœ…
Motif (liste + texte libre)	Retard / MÃ©tÃ©o / MatÃ©riel / Attente / Sous-traitant / Autre	âš ï¸ si blocage/suspension
Claim ?	Oui / Non â†’ sous-formulaire	âš ï¸ si Oui
Photo / justificatif	Upload	Optionnel
Heure de saisie	Auto	âœ…
Cas spÃ©ciaux :
â€¢	Blocage intrajournalier :
o	Une 2áµ‰ remontÃ©e autorisÃ©e le mÃªme jour, taguÃ©e is_block_event=true.
o	Enregistre lâ€™heure du blocage et le motif obligatoire.
â€¢	Suspension :
o	Active le mode suspension_flag=true.
o	DÃ©finit suspension_start et suspension_end (ou ouverte).
o	Exclue les heures du calcul â€œmÃ©talâ€.
________________________________________
ğŸ”¹ 3.3 Gestion du temps mÃ©tal
Le temps mÃ©tal = durÃ©e de travail productif hors suspension.
heures_metal = heures_presence - Î£ durÃ©es_suspension
â€¢	Mise Ã  jour automatique du champ effort_reel_h dans la Gantt.
â€¢	Si suspension_end non renseignÃ©e â†’ suspension considÃ©rÃ©e â€œouverteâ€ â†’ affichÃ©e comme alerte le lendemain matin.
________________________________________
ğŸ”¹ 3.4 Confirmation quotidienne
Chaque fin de journÃ©e, le responsable doit :
â€¢	Ouvrir la vue â€œÃ€ confirmerâ€ : toutes les tÃ¢ches avec une remontÃ©e non confirmÃ©e.
â€¢	VÃ©rifier et cliquer sur â€œConfirmer lâ€™Ã©tat du jourâ€ :
o	Si validÃ© â†’ la ligne passe en etat_confirme=true.
o	La donnÃ©e du jour est gelÃ©e dans la table remontee_site_reporting.
o	Une copie horodatÃ©e est crÃ©Ã©e dans historique_actions.
o	La tÃ¢che reste active dans la Gantt mais marquÃ©e â€œconfirmÃ©e du jourâ€.
Bonus : un rappel automatique (Power Automate ou Supabase Function) Ã  17h30 si aucune confirmation reÃ§ue.
________________________________________
ğŸ”¹ 3.5 Section Reporting (journal figÃ©)
â€¢	AccÃ¨s lecture seule (Planificateur / Direction).
â€¢	Reprend toutes les lignes â€œconfirmÃ©esâ€.
â€¢	Colonnes clÃ©s :
o	Date / Site / TÃ¢che / Statut rÃ©el / Avancement / PrÃ©sents / Heures mÃ©tal / Claim / Motif.
â€¢	Utilisable comme base Power BI.
â€¢	Les enregistrements ne sont plus modifiables (archivage figÃ©).
________________________________________
4ï¸âƒ£ ModÃ¨le de donnÃ©es (Supabase)
Table remontee_site
Champ	Type	Description
id	uuid	Identifiant
site_id	uuid	FK â†’ sites
affaire_id	uuid	FK â†’ affaires
tache_id	uuid	FK â†’ planning_taches
date_saisie	date	Date du jour
statut_reel	text	Non lancÃ©e / En cours / TerminÃ©e / BloquÃ©e / Suspendue / ReportÃ©e / ProlongÃ©e
avancement_pct	float	0â€“100
nb_present	int	PrÃ©sents rÃ©els
nb_planifie	int	PlanifiÃ©s
heures_presence	numeric	Heures totales
heures_metal	numeric	Heures productives (hors suspensions)
motif	text	Motif blocage / suspension
commentaire	text	Notes
claim	bool	Oui/Non
claim_type	text	Type claim
claim_valeur	float	CoÃ»t estimÃ©
is_block_event	bool	Ã‰vÃ©nement blocage journalier
block_time	timestamp	Heure blocage
suspension_flag	bool	Oui si suspension active
suspension_start	timestamp	DÃ©but suspension
suspension_end	timestamp	Fin suspension
etat_confirme	bool	true = confirmÃ© du jour
created_by	uuid	Auteur
date_creation	timestamp	Horodatage
________________________________________
Table remontee_site_reporting
(copie figÃ©e des enregistrements confirmÃ©s)
Champ	Type	Description
id	uuid	Identifiant unique
remontee_id	uuid	FK vers la table source
date_report	date	Date du jour figÃ©
tache_id	uuid	Lien vers tÃ¢che
site_id	uuid	Lien site
affaire_id	uuid	Lien affaire
statut_final	text	Statut rÃ©el confirmÃ©
avancement_final	float	% final
nb_present	int	PrÃ©sents
heures_metal	numeric	Heures productives
motif	text	Motif
claim	bool	Claim dÃ©clarÃ©
commentaire	text	Note finale
confirme_par	uuid	Auteur confirmation
date_confirmation	timestamp	Heure confirmation
________________________________________
Table tache_suspensions
(mÃªmes rÃ¨gles que PRD prÃ©cÃ©dent â€” tracking fin des suspensions)
________________________________________
5ï¸âƒ£ RÃ¨gles mÃ©tier
Cas	Comportement
1 remontÃ©e/jour/tÃ¢che	Exception autorisÃ©e si blocage intrajournalier
Blocage intrajournalier	CrÃ©e une ligne is_block_event=true
Suspension active	Exclue du temps mÃ©tal jusquâ€™Ã  reprise
Confirmation quotidienne	Fige la donnÃ©e + copie en reporting
TÃ¢ches non confirmÃ©es	Alertes planificateur 17h30
Claim activÃ©	CrÃ©ation auto dans module claims
Ã‰tat confirmÃ©	Non Ã©ditable aprÃ¨s validation
________________________________________
6ï¸âƒ£ CritÃ¨res dâ€™acceptation
ID	Description	Validation
REM-01	1 remontÃ©e/jour (hors blocage)	âœ…
REM-02	Blocage intrajournalier autorisÃ© (motif obligatoire)	âœ…
REM-03	Suspension exclue du temps mÃ©tal	âœ…
REM-04	Temps mÃ©tal recalculÃ© automatiquement	âœ…
REM-05	Confirmation quotidienne obligatoire	âœ…
REM-06	DonnÃ©es confirmÃ©es figÃ©es en reporting	âœ…
REM-07	Alerte 17h30 si pas confirmÃ©	âœ…
REM-08	Synchronisation auto Gantt & finances	âœ…
REM-09	Interface fluide + mobile friendly	âœ…
________________________________________
7ï¸âƒ£ Stack technique
Ã‰lÃ©ment	Lib / Service
Backend	Supabase (remontee_site, remontee_site_reporting, tache_suspensions)
Frontend	Next.js + Tailwind
Forms	React Hook Form + Zod
Charts	Recharts
Realtime	Supabase Realtime
Cron / Alertes	Supabase Function / Power Automate
Auth	Supabase Session (rÃ´les Resp / Chef / Planif)
________________________________________
8ï¸âƒ£ UI / Composants
Composant	Description
SiteTaskList	Liste des tÃ¢ches du jour par site
RemonteeFormModal	Formulaire de saisie Ã©tat rÃ©el
BlockButton	Bouton â€œDÃ©clarer blocage immÃ©diatâ€
SuspendButton	Bouton â€œSuspendre / Reprendre activitÃ©â€
ConfirmEndOfDayModal	Validation des Ã©tats du jour
ReportingTable	Vue figÃ©e post-confirmation
SyncIndicator	Indique si la Gantt a reÃ§u la MAJ
AlertToast	Rappels et notifications fin de journÃ©e
________________________________________
9ï¸âƒ£ Workflow global
graph TD
A[Planification Gantt] --> B[RemontÃ©e terrain quotidienne]
B -->|Ã‰tat rÃ©el, blocage, suspension| C[Synchronisation Gantt]
B -->|En fin de journÃ©e| D[Confirmation Ã©tat]
D -->|ValidÃ©| E[Reporting figÃ©]
E -->|Lecture seule| F[Dashboard / Power BI]
________________________________________
ğŸ”Ÿ Exemple du cycle dâ€™une journÃ©e type
1.	Matin 07:30 : Chef signale tÃ¢che â€œEn cours â€“ 3 prÃ©sentsâ€.
2.	11:00 : Blocage matÃ©riel â†’ 2áµ‰ remontÃ©e autorisÃ©e is_block_event=true.
3.	13:30 : Reprise â†’ suspension close, temps mÃ©tal = 5h.
4.	17:15 : Responsable confirme les statuts â†’ copie dans remontee_site_reporting.
5.	18:00 : TÃ¢che visible dans reporting + KPI journaliers mis Ã  jour.


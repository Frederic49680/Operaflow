---
alwaysApply: true
---
ğŸ§­ PRD â€” Module Terrain : Vue Liste & Tuiles interactives

Auteur : Fred Baudry
Version : 1.4
Stack : Next.js / Supabase / Tailwind / Recharts
Objectif :
Permettre aux responsables de chantier et aux chargÃ©s de rÃ©alisation de suivre, mettre Ã  jour et confirmer quotidiennement lâ€™Ã©tat rÃ©el des tÃ¢ches planifiÃ©es, via une interface mixte liste + tuiles visuelles reliÃ©e au Gantt et au Dashboard.

1ï¸âƒ£ Objectif gÃ©nÃ©ral

CrÃ©er une expÃ©rience terrain fluide qui combine :

une vue liste consolidÃ©e des tÃ¢ches planifiÃ©es pour le site et la pÃ©riode,

une vue tuile ludique et rÃ©active pour les mises Ã  jour de statuts,

des rÃ¨gles automatiques de suivi journalier (confirmation, suspension),

et la gestion des blocages globaux (grÃ¨ves, accÃ¨s, mÃ©tÃ©o).

Cette interface remplace les formulaires â€œclassiquesâ€ et synchronise en temps rÃ©el les donnÃ©es de planification, dâ€™avancement et de reporting.

2ï¸âƒ£ Vue Liste principale
ğŸ”¹ Contenu

Liste des affaires planifiÃ©es / en suivi sur le site de lâ€™utilisateur.

Colonnes :

Affaire

Responsable

% avancement

Nombre de tÃ¢ches du jour

Dernier statut global (calculÃ© Ã  partir des tÃ¢ches)

Bouton â€œğŸ“‹ Ouvrirâ€ â†’ ouvre la vue tuiles

ğŸ”¹ Actions

ğŸ” Recherche par mot-clÃ© (affaire, activitÃ©)

Filtres rapides :

Statut global (PlanifiÃ©e / En cours / Suspendue / ReportÃ©e / ProlongÃ©e / TerminÃ©e)

Site

Responsable

Date

SÃ©lection multi-affaires (pour reporting groupÃ©)

3ï¸âƒ£ Vue Tuiles (au clic sur une affaire)

Quand on clique sur une ligne dâ€™affaire â†’ ouverture dâ€™une vue tuilÃ©e (overlay ou panneau latÃ©ral selon device).

Chaque tuile reprÃ©sente une tÃ¢che du jour ou en cours pour cette affaire.

ğŸ”¹ Contenu de chaque tuile
Ã‰lÃ©ment	Description
ğŸ·ï¸ LibellÃ© tÃ¢che	Nom clair de lâ€™activitÃ©
ğŸ—ï¸ Site	Code site
ğŸ‘· Responsable exÃ©cution	Nom du chargÃ© de rÃ©alisation
ğŸ“… Dates	DÃ©but planifiÃ© / Fin planifiÃ©e
âš™ï¸ Statut actuel	Badge colorÃ© + libellÃ©
â±ï¸ Avancement	% affichÃ© + barre de progression
ğŸ§© Actions rapides	Boutons de statut (Lancer / Suspendre / Reporter / Prolonger / Terminer)
ğŸ“– Notes / commentaires	Champ libre + icÃ´ne ğŸ““
ğŸ” Historique	Petit bouton (âŒ›) pour voir les derniÃ¨res modifications
4ï¸âƒ£ Ã‰tats possibles des tuiles
ğŸŸ¡ 1ï¸âƒ£ Ã€ lancer (tÃ¢che prÃ©vue aujourdâ€™hui)
ğŸŸ¡ Ã€ lancer â€” PrÃ©vue le 22/10
------------------------------------------------
ğŸ“ Site : E-03A | ğŸ‘· Steven
ğŸ•’ 22/10 â†’ 24/10
âš™ï¸ En attente de lancement
[ ğŸ”µ Lancer ] [ ğŸŸ  Reporter ] [ ğŸŸ£ Prolonger ]

ğŸ”µ 2ï¸âƒ£ En cours
ğŸ”µ En cours â€” Jour 2/3
------------------------------------------------
ğŸ“ Site : DAM | ğŸ‘· Jason
ğŸ•’ 21/10 â†’ 23/10
â±ï¸ Avancement : 45%
[ ğŸŸ¢ Terminer ] [ âš« Suspendre ] [ ğŸŸ£ Prolonger ]
------------------------------------------------
ğŸ’¬ â€œTravail normal, zone dÃ©gagÃ©eâ€

âš« 3ï¸âƒ£ Suspendu (non actif, pas dâ€™heure mÃ©tal)
âš« Suspendu â€” Depuis 1 jour
------------------------------------------------
ğŸ“ Site : E-03A | ğŸ‘· Steven
â›” ActivitÃ© en pause (absence Ã©quipe)
â¸ï¸ Reprise prÃ©vue : 24/10 ?
[ ğŸ”µ Relancer ] [ ğŸŸ  Reporter ] [ ğŸŸ£ Prolonger ]
------------------------------------------------
â„¹ï¸ Cause : Absence Ã©quipe IEG

ğŸŸ  4ï¸âƒ£ ReportÃ© (planifiÃ© plus tard)
ğŸŸ  ReportÃ© â€” Reprise le 26/10
------------------------------------------------
ğŸ“ Site : PDC_FBA | ğŸ‘· Marc
ğŸ•’ Ancien dÃ©but : 22/10 | Nouveau : 26/10
âš™ï¸ Impact fin Ã  confirmer
[ âœ… Aucun impact ] [ â±ï¸ Total ] [ ğŸ“Š % ] [ â• +X jours ]
------------------------------------------------
â„¹ï¸ Cause : Attente matÃ©riel

ğŸŸ£ 5ï¸âƒ£ ProlongÃ© (ex-BloquÃ©)
ğŸŸ£ ProlongÃ© â€” DurÃ©e Ã©tendue +2 jours
------------------------------------------------
ğŸ“ Site : E-03A | ğŸ‘· Steven
ğŸ•’ 21/10 â†’ 26/10 (au lieu de 24/10)
ğŸ“– Cause : accÃ¨s limitÃ© / mÃ©tÃ©o
âš™ï¸ Fin recalculÃ©e
[ ğŸŸ¢ Terminer ] [ âš« Suspendre ]

ğŸŸ¢ 6ï¸âƒ£ TerminÃ©e
ğŸŸ¢ TerminÃ©e â€” 100%
------------------------------------------------
ğŸ“ Site : E-03A | ğŸ‘· Steven
ğŸ•’ RÃ©el : 21/10 â†’ 23/10
âœ… ClÃ´turÃ©e avec succÃ¨s
ğŸ“ˆ Temps mÃ©tal : 21h

5ï¸âƒ£ Confirmation quotidienne automatique
RÃ¨gle :

Chaque jour Ã  06h30, toutes les tÃ¢ches En_cours sont interrogÃ©es :

â€œReprise aujourdâ€™hui sur [TÃ¢che X] ?â€

Si Oui â†’ insertion auto de remontee_site (statut = â€œEn_coursâ€).

Si Non ou pas de rÃ©ponse avant 12h â†’ tÃ¢che â†’ Suspendu + tache_suspensions.

ImplÃ©mentation :

Cron : cron_confirm_en_cours

Table : confirmation_queue

Notification : Badge âš ï¸ â€œRÃ©ponse attendueâ€

UI : sur tuile â€œEn coursâ€ â†’ petit bandeau jaune â€œConfirmer la repriseâ€

6ï¸âƒ£ Blocage gÃ©nÃ©ral (grÃ¨ve / accÃ¨s)
DÃ©claration :

Menu â€œBlocage gÃ©nÃ©ralâ€ (accessible RH / Planif / Dir)

SÃ©lection :

Site ou pÃ©rimÃ¨tre dâ€™affaire

Motif

DÃ©but / Fin

Validation â†’ toutes les tÃ¢ches planifiÃ©es ou en cours sur ce site passent :

statut = Suspendu

crÃ©ation dâ€™une tache_suspensions

crÃ©ation dâ€™un site_blocages record

Effets visuels :

Bande grisÃ©e verticale sur le Gantt

Message sur liste : â€œâš  Site en blocage gÃ©nÃ©ral â€” tÃ¢ches gelÃ©esâ€

BanniÃ¨re rouge en haut de la page terrain :

â€œGrÃ¨ve / accÃ¨s bloquÃ© du 22/10 au 25/10 â€” reprise Ã  confirmerâ€

7ï¸âƒ£ Reprise aprÃ¨s ReportÃ©

Quand une tÃ¢che â€œReportÃ©eâ€ est relancÃ©e :

â€œLe report a-t-il impactÃ© la date de fin prÃ©vue ?â€

Choix :

Aucun impact â†’ on garde la mÃªme fin

Impact total â†’ on ajoute Î” report

Impact partiel â†’ on saisit %

Impact valeur â†’ on saisit X jours

â†’ fn_resume_from_report(tache_id, mode, value) ajuste date_fin_plan + effort_plan_h.

8ï¸âƒ£ ModÃ¨le de donnÃ©es impactÃ©
Table planning_taches

âœ… statut â†’ ajouter valeurs (â€˜Prolongeâ€™, â€˜Suspenduâ€™)

âœ… responsable_execution_id uuid fk

âœ… descendu_vers_execution bool

âœ… date_transfert_execution timestamptz

Table site_blocages
Champ	Type	Description
id	uuid	
site_id	uuid	FK
affaire_id	uuid nullable	Sous-pÃ©rimÃ¨tre optionnel
cause	text	GrÃ¨ve, accÃ¨s, etc.
start_at	timestamptz	
end_at	timestamptz	
scope_level	text	'site' / 'affaire'
created_by	uuid	
created_at	timestamptz	
9ï¸âƒ£ Automatisations
Fonction / Cron	Description
fn_auto_descente_realisation()	Ã  06h00 â†’ transfert des tÃ¢ches du jour vers exÃ©cution
cron_confirm_en_cours	Ã  06h30 â†’ confirmation quotidienne
fn_apply_site_blocage()	applique le gel aux tÃ¢ches en cours / Ã  lancer
fn_resume_from_report()	ajuste la fin Ã  la reprise
fn_auto_close_suspension()	ferme les suspensions Ã  la reprise
ğŸ”Ÿ RÃ¨gles techniques & UX

Une seule remontÃ©e terrain par tÃ¢che/jour.

Auto-save sur chaque clic dâ€™action.

Undo 30 secondes aprÃ¨s action (toast).

Animation fluide (fade-out tuile terminÃ©e).

Overlay latÃ©ral sur desktop, plein Ã©cran sur mobile.

Couleurs fixes :

ğŸŸ¢ TerminÃ©

ğŸ”µ En cours

âš« Suspendu

ğŸŸ  ReportÃ©

ğŸŸ£ ProlongÃ©

ğŸŸ¡ Ã€ lancer

1ï¸âƒ£1ï¸âƒ£ CritÃ¨res dâ€™acceptation
ID	CritÃ¨re	Validation
TUI-01	Liste affaires + ouverture tuiles OK	âœ…
TUI-02	Tous les statuts visibles et cliquables	âœ…
TUI-03	Confirmation quotidienne auto	âœ…
TUI-04	Blocage gÃ©nÃ©ral gÃ¨le les tÃ¢ches du site	âœ…
TUI-05	Reprise aprÃ¨s report ajustable	âœ…
TUI-06	RemontÃ©es cohÃ©rentes et uniques	âœ…
TUI-07	Animation + UX fluide	âœ…
TUI-08	Synchro instantanÃ©e Gantt + Dashboard	âœ…
1ï¸âƒ£2ï¸âƒ£ IntÃ©grations & impacts connexes
Module	Impact
Gantt	Statuts mis Ã  jour + couleurs + overlay blocage
Dashboard	Nouvelles mÃ©triques â€œTÃ¢ches prolongÃ©esâ€ et â€œSuspensions activesâ€
Claims	DÃ©clencheur sur â€œProlongÃ©â€ possible
Maintenance	MÃªme logique dâ€™Ã©tats
Reporting figÃ©	Capturer les statuts chaque jour Ã  23h59
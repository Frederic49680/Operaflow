---
alwaysApply: true
---
ğŸ§­ PRD â€” Module Gantt (Planification & Pilotage)
Auteur : Fred Baudry
Version : 1.0
Stack : Next.js 15 / Supabase / Tailwind / Recharts / D3-Gantt ou Frappe-Gantt
Objectif principal :
Offrir une interface de planification complÃ¨te, interactive et hiÃ©rarchique pour gÃ©rer les tÃ¢ches, affectations, avancements, et atterrissages financiers, tout en assurant la cohÃ©rence avec les modules RH, Affaires, Sites et Absences.
________________________________________
1ï¸âƒ£ Objectif
CrÃ©er une vue Gantt interactive permettant au planificateur de :
â€¢	Visualiser et organiser les affaires et leurs lots (issus du module Base Affaires) ;
â€¢	CrÃ©er, dÃ©placer, modifier et lier les tÃ¢ches planifiÃ©es ;
â€¢	Affecter des ressources selon leurs compÃ©tences et disponibilitÃ©s rÃ©elles ;
â€¢	Synchroniser automatiquement les avancements et dates rÃ©elles avec :
o	la base financiÃ¨re (atterrissages),
o	les indicateurs de charge et couverture,
o	et les modules RH / Absences.
________________________________________
2ï¸âƒ£ Utilisateurs cibles
RÃ´le	AccÃ¨s	Actions
Planificateur	AccÃ¨s total	CRUD sur les tÃ¢ches, affectations, avancements
ChargÃ© dâ€™Affaires	Lecture + validation avancement	Consulte les tÃ¢ches liÃ©es Ã  ses affaires
Responsable de site	Lecture	Visualise uniquement les affaires de son site
Direction / PMO	Lecture globale	Vue consolidÃ©e multi-sites et filtres financiers
________________________________________
3ï¸âƒ£ FonctionnalitÃ©s principales
ğŸ”¹ 3.1 Arborescence hiÃ©rarchique
Structure de base du Gantt :
Site â†’ Affaire â†’ Lot â†’ TÃ¢che â†’ Ressources
â€¢	Chaque nÅ“ud est pliable/dÃ©pliable.
â€¢	Les tÃ¢ches sont colorÃ©es par statut (En cours / TerminÃ© / BloquÃ© / ReportÃ©).
â€¢	Les lots affichent leur % dâ€™avancement global et atterrissage financier en survol.
â€¢	Les affaires affichent leur taux global, marge rÃ©visÃ©e, et date de fin prÃ©visionnelle.
________________________________________
ğŸ”¹ 3.2 Gestion des tÃ¢ches
â€¢	CrÃ©ation rapide (clic + glisser sur la timeline)
â€¢	Champs :
o	Nom de la tÃ¢che
o	Dates dÃ©but/fin planifiÃ©es
o	Type (PrÃ©paration, ExÃ©cution, ContrÃ´le, Autre)
o	CompÃ©tence requise
o	Ressources affectÃ©es (multi-sÃ©lection filtrÃ©e)
o	% dâ€™avancement (manuel ou auto si journal dâ€™activitÃ© actif)
o	Statut (Non lancÃ© / En cours / TerminÃ© / BloquÃ© / ReportÃ©)
o	Lien affaire_id et lot_id (pour lier au financier)
â€¢	Actions :
o	Glisser/dÃ©placer pour modifier dates
o	Redimensionner pour ajuster durÃ©e
o	Supprimer (archivage uniquement)
o	Dupliquer tÃ¢che (template rÃ©utilisable)
________________________________________
ğŸ”¹ 3.3 Affectations & ressources
â€¢	SÃ©lecteur intelligent : affiche uniquement les ressources actives, non absentes, et compÃ©tentes.
â€¢	Alertes en cas de :
o	Suraffectation (ressource dÃ©jÃ  engagÃ©e sur une autre tÃ¢che sur les mÃªmes dates)
o	InadÃ©quation compÃ©tence (ex : tÃ¢che IEG mais ressource AUTO seule)
â€¢	PossibilitÃ© dâ€™ajuster la charge :
o	En heures planifiÃ©es (ex : 14h sur 2 jours)
o	En taux (%) de prÃ©sence par jour
â€¢	Affichage dynamique de la capacitÃ© restante par ressource.
________________________________________
ğŸ”¹ 3.4 Synchronisation automatique
Liens avec les autres modules :
Module	DonnÃ©e Ã©changÃ©e	Direction
Affaires / Lots	Dates rÃ©elles, avancement, consommÃ©s, atterrissage	â†”
RH Collaborateurs	Statut actif, compÃ©tences, contrat	â†
Absences	IndisponibilitÃ©s journaliÃ¨res	â†
AdÃ©quation Charge/CompÃ©tence	Avancement rÃ©el / besoin restant	â†”
Suivi Projets	Statut tÃ¢che et progression	â†”
Chaque modification de tÃ¢che (dates, % ou ressource) dÃ©clenche une MAJ Supabase Function â†’ recalcul des avancements et atterrissages.
________________________________________
ğŸ”¹ 3.5 Avancement & suivi
â€¢	% dâ€™avancement par tÃ¢che (manuel ou alimentÃ© par saisies quotidiennes)
â€¢	Avancement lot = moyenne pondÃ©rÃ©e des tÃ¢ches liÃ©es
â€¢	Avancement affaire = moyenne pondÃ©rÃ©e des lots
â€¢	Affichage visuel :
o	Barre de progression interne Ã  la tÃ¢che
o	Code couleur selon avancement (vert >75%, orange 25â€“75%, rouge <25%)
o	Ligne verticale â€œaujourdâ€™huiâ€
â€¢	Affaires avec dÃ©rive = surlignÃ©es (date rÃ©elle > fin prÃ©vue)
________________________________________
ğŸ”¹ 3.6 Vue filtrÃ©e et KPI dynamiques
Filtres combinables :
â€¢	Site / Affaire / CompÃ©tence / Responsable / Ressource
â€¢	Statut tÃ¢che (En cours / BloquÃ© / TerminÃ©)
â€¢	Horizon temporel (semaine, mois, trimestre)
â€¢	Option "afficher uniquement les tÃ¢ches non terminÃ©es"
KPI affichÃ©s en haut :
Indicateur	Description
Nb tÃ¢ches actives	Total en cours sur la pÃ©riode
Taux de couverture	% ressources disponibles / requises
Atterrissage total	Somme des atterrissages affaires visibles
Retard moyen (jours)	Moyenne (fin rÃ©elle - fin prÃ©vue)
Suraffectations dÃ©tectÃ©es	Nb ressources en doublon
________________________________________
ğŸ”¹ 3.7 Interaction & ergonomie
â€¢	Zoom horizontal (jour / semaine / mois / trimestre)
â€¢	DÃ©filement fluide + sticky header
â€¢	Lignes horizontales colorÃ©es par site
â€¢	Tooltip dÃ©taillÃ© (dates, ressource, avancement, coÃ»t)
â€¢	Double-clic = ouvrir modale tÃ¢che
â€¢	Drag & drop = rÃ©affectation directe
â€¢	Sauvegarde automatique toutes les 30 secondes
________________________________________
4ï¸âƒ£ ModÃ¨le de donnÃ©es (Supabase)
Table : planning_taches
Champ	Type	Description
id	uuid	Identifiant
affaire_id	uuid	Lien â†’ affaires.id
lot_id	uuid	Lien â†’ affaires_lots.id
site_id	uuid	Lien â†’ sites.id
libelle_tache	text	Nom de la tÃ¢che
type_tache	text	PrÃ©paration / ExÃ©cution / etc.
competence	text	Code compÃ©tence requise
date_debut_plan	date	PlanifiÃ© dÃ©but
date_fin_plan	date	PlanifiÃ© fin
date_debut_reelle	date	RÃ©elle dÃ©but
date_fin_reelle	date	RÃ©elle fin
effort_plan_h	numeric	Heures planifiÃ©es
effort_reel_h	numeric	Heures consommÃ©es
avancement_pct	numeric	0â€“100
statut	text	Non lancÃ© / En cours / TerminÃ© / BloquÃ© / ReportÃ©
ressource_ids	uuid[]	Tableau de ressources affectÃ©es
created_by	uuid	CrÃ©ateur
date_creation	timestamp	Ajout
________________________________________
5ï¸âƒ£ RÃ¨gles mÃ©tiers
â€¢	Une tÃ¢che doit Ãªtre liÃ©e Ã  une affaire validÃ©e.
â€¢	Si lot_id non dÃ©fini â†’ tÃ¢che visible mais marquÃ©e â€œnon ventilÃ©eâ€.
â€¢	Dates rÃ©elles mises Ã  jour uniquement si avancement > 0 %.
â€¢	Si tÃ¢che â€œBloquÃ©eâ€ â†’ notification au CA et au Responsable de site.
â€¢	Si tÃ¢che â€œTerminÃ©eâ€ â†’ MAJ automatique du lot et de lâ€™affaire.
â€¢	En cas de suraffectation, sauvegarde possible mais signalÃ©e visuellement (pastille rouge).
â€¢	Suppression physique interdite (archivage).
________________________________________
6ï¸âƒ£ CritÃ¨res dâ€™acceptation
ID	CritÃ¨re	Validation
GANTT-01	Affichage arborescent complet (Site â†’ Affaire â†’ Lot â†’ TÃ¢che)	âœ…
GANTT-02	CRUD tÃ¢ches opÃ©rationnel (formulaire + drag/drop)	âœ…
GANTT-03	Liaison tÃ¢che â†” lot / affaire fonctionnelle	âœ…
GANTT-04	Avancement auto â†’ MAJ des atterrissages	âœ…
GANTT-05	Suraffectation dÃ©tectÃ©e en temps rÃ©el	âœ…
GANTT-06	Filtres et zooms temporels fluides	âœ…
GANTT-07	DonnÃ©es synchronisÃ©es avec modules liÃ©s	âœ…
GANTT-08	Interface rÃ©active et sauvegarde auto	âœ…
________________________________________
7ï¸âƒ£ Stack technique
Ã‰lÃ©ment	Lib / Outil
Backend	Supabase (planning_taches) + Functions de synchro
Frontend	Next.js + Tailwind
Gantt Engine	Frappe-Gantt ou D3.js custom
Formulaires	React Hook Form + Zod
Charts	Recharts (KPI)
Realtime Sync	Supabase Realtime / WebSocket
Auth	Supabase Session (Planif / CA / Resp)
________________________________________
8ï¸âƒ£ UI / Composants clÃ©s
Composant	RÃ´le
GanttTreeView	Arborescence Site â†’ Affaire â†’ Lot â†’ TÃ¢ches
GanttTimeline	Vue graphique (barres / zoom)
TaskFormModal	Formulaire crÃ©ation / Ã©dition
ResourceSelector	Filtre intelligent ressources disponibles
FinanceSyncTag	Badge indiquant si tÃ¢che liÃ©e Ã  un lot financier
KPIBar	Indicateurs haut de page
ConflictChip	Alerte suraffectation
AutoSaveToast	Feedback de sauvegarde
________________________________________
9ï¸âƒ£ IntÃ©gration inter-modules
Module	Interaction
Sites	Regroupement principal et filtrage
Affaires / Lots	Remonte dates et avancement (atterrissage)
RH / Ressources	VÃ©rifie statut actif + compÃ©tence
Absences	Exclut ressources indisponibles
AdÃ©quation charge / compÃ©tence	Met Ã  jour charge rÃ©elle
Suivi projets	Alimente les statuts et alertes
Claims	Blocages dÃ©clenchent crÃ©ation de claim
________________________________________
10ï¸âƒ£ Vue de synthÃ¨se â€” cycle des donnÃ©es
Affaire (CA) 
   â†“ (ValidÃ©e)
Lots financiers 
   â†“ (LiÃ©s Ã  tÃ¢ches)
Gantt (Planificateur)
   â†•
Ressources / Absences / CompÃ©tences
   â†“
Atterrissage (calcul auto)
   â†“
Suivi projets / Dashboard


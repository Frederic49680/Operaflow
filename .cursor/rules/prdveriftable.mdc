---
alwaysApply: true
---
ğŸ§© PRD â€“ VÃ©rification Globale du SchÃ©ma & des RÃ´les
ğŸ¯ Objectif

Mettre en place un module dâ€™audit automatique dans Cursor pour :

VÃ©rifier la cohÃ©rence entre le modÃ¨le de donnÃ©es (tables/colonnes) et les requÃªtes SQL existantes.

VÃ©rifier la conformitÃ© des noms (format, cohÃ©rence, norme de nommage).

Identifier les anomalies : colonnes manquantes, incohÃ©rences de casse, alias non trouvÃ©s, erreurs de jointures, etc.

Clarifier et auditer les rÃ´les dans lâ€™application (autorisations techniques) vs rÃ´les mÃ©tier (hiÃ©rarchie entreprise).

âš™ï¸ PÃ©rimÃ¨tre
A. VÃ©rification du modÃ¨le de donnÃ©es

Objectif : vÃ©rifier chaque table, colonne et clÃ© de la base par rapport aux requÃªtes utilisÃ©es dans le code (SQL, Supabase, Prisma, etc.)

1. VÃ©rification de structure

Lister toutes les tables existantes dans le schÃ©ma (via introspection Supabase / schema.sql).

Lister toutes les colonnes (nom, type, contrainte).

Comparer avec les requÃªtes SQL / API existantes dans le projet (par parsing des fichiers .ts, .js, .sql).

2. VÃ©rification de nommage

Convention de nommage Ã  appliquer :

Tables : snake_case (ex: suivi_activite, affaires, utilisateurs)

Colonnes : camelCase pour le code, snake_case pour la DB.

ClÃ©s Ã©trangÃ¨res : [table]_id

Champs systÃ¨me : created_at, updated_at, deleted_at

GÃ©nÃ©rer un rapport :

âœ… conformitÃ©

âš ï¸ nom incohÃ©rent

âŒ colonne manquante ou non utilisÃ©e

3. VÃ©rification de cohÃ©rence requÃªtes / DB

Identifier les requÃªtes appelant des champs inexistants.

Identifier les tables jamais requÃªtÃ©es.

VÃ©rifier les jointures cohÃ©rentes (site_id liÃ© Ã  sites.id, etc.).

DÃ©tecter les types incohÃ©rents entre les requÃªtes et le schÃ©ma (int vs text).

B. VÃ©rification des rÃ´les
1. RÃ´les de lâ€™application

LiÃ©s Ã  la gestion des droits dans lâ€™app, pas Ã  la hiÃ©rarchie rÃ©elle.

RÃ´le App	Description	AccÃ¨s principaux
SuperAdmin	ContrÃ´le total (configuration, crÃ©ation utilisateurs, supervision globale)	Toutes les pages + admin
Responsable / Manager	Supervise un site ou pÃ©rimÃ¨tre dÃ©fini	AccÃ¨s restreint par SiteID
Utilisateur	ExÃ©cute et dÃ©clare les activitÃ©s	AccÃ¨s Ã  ses affaires / activitÃ©s uniquement
Consultant / RH / Financier	Lecture seule ou accÃ¨s spÃ©cialisÃ© (formation, heures, coÃ»ts)	Lecture / modules spÃ©cifiques
2. RÃ´les de lâ€™entreprise

ReprÃ©sentent la hiÃ©rarchie rÃ©elle et les responsabilitÃ©s opÃ©rationnelles.

Fonction MÃ©tier	Description	Correspondance RÃ´le App
Conducteur de Travaux	GÃ¨re la planification, le suivi et la coordination	Responsable / Manager
Chef de Chantier	Supervise lâ€™exÃ©cution sur site	Utilisateur (avec accÃ¨s Ã©tendu)
Technicien / OpÃ©rateur	RÃ©alise les activitÃ©s planifiÃ©es	Utilisateur
Responsable dâ€™Agence / Site	Pilote un ou plusieurs chantiers	SuperAdmin ou Manager
Administratif / RH / Finance	Suit les formations, heures, coÃ»ts	Consultant / RH / Financier

ğŸ§  Note : un mÃªme utilisateur peut cumuler plusieurs rÃ´les app selon les modules (ex : un conducteur peut aussi Ãªtre RH pour son site).

ğŸ§ª RÃ©sultats attendus de lâ€™audit
Rapport de sortie

âœ… Tables et colonnes vÃ©rifiÃ©es

âš ï¸ Champs incohÃ©rents ou manquants

âŒ RequÃªtes invalides

ğŸ“Š Taux de couverture du modÃ¨le par le code

ğŸ” RÃ´les applicatifs utilisÃ©s vs dÃ©finis

ğŸ”„ Mapping rÃ´les app â†” rÃ´les entreprise

Format exportable : .md / .csv / .json

ğŸ§± Exemple de tÃ¢che Cursor Ã  exÃ©cuter
# Exemple de tÃ¢che Cursor (pseudo-yaml)
task: "VÃ©rification cohÃ©rence DB"
steps:
  - Extract all table & column definitions from /supabase/schema.sql
  - Parse all SQL/Prisma/Supabase queries in /src
  - Compare references and report mismatches
  - Check naming conventions per table
  - Generate report "audit_structure.md"

ğŸš¦ Livrables
Livrable	Description	Format
Rapport dâ€™audit	RÃ©sumÃ© complet des vÃ©rifications	.md
Fichier de corrections	Liste des modifications recommandÃ©es (noms, types, requÃªtes)	.csv
Rapport des rÃ´les	Mapping hiÃ©rarchique + autorisations app	.md
Log de vÃ©rification	DÃ©tails techniques de chaque check	.json